<!DOCTYPE html>
<html class=" ya-page_js_yes"><head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <meta charset="UTF-8">
    <!-- base href="https://e-maxx-eng.appspot.com/" -->
    <title>Balanced bracket sequences  - E-Maxx Algorithms</title>
    <script async="" src="Balanced%20bracket%20sequences%20-%20E-Maxx%20Algorithms_files/analytics.js"></script><script type="text/javascript" async="" charset="utf-8" src="Balanced%20bracket%20sequences%20-%20E-Maxx%20Algorithms_files/all.js"></script><script src="Balanced%20bracket%20sequences%20-%20E-Maxx%20Algorithms_files/jq.js"></script>
    <script src="Balanced%20bracket%20sequences%20-%20E-Maxx%20Algorithms_files/common.js"></script>
    <script type="text/x-mathjax-config;executed=true">
        MathJax.Hub.Config({tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]}});
    </script>
    <script type="text/javascript" src="Balanced%20bracket%20sequences%20-%20E-Maxx%20Algorithms_files/MathJax.js">
    </script>
    <link rel="stylesheet" href="Balanced%20bracket%20sequences%20-%20E-Maxx%20Algorithms_files/common.css">

    <!-- highlightjs for code highlighting -->
    <link rel="stylesheet" href="Balanced%20bracket%20sequences%20-%20E-Maxx%20Algorithms_files/xcode.css">
    <script src="Balanced%20bracket%20sequences%20-%20E-Maxx%20Algorithms_files/highlight.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <!-- end highlightjs -->
    <meta name="google-site-verification" content="qSnbeMPNVgZ3kIpGVsPIAPIvEdwYSg583kPdwgJtFO8">
    <meta name="yandex-verification" content="dac3ebdbebe78eec">
<style type="text/css">.MathJax_Hover_Frame {border-radius: .25em; -webkit-border-radius: .25em; -moz-border-radius: .25em; -khtml-border-radius: .25em; box-shadow: 0px 0px 15px #83A; -webkit-box-shadow: 0px 0px 15px #83A; -moz-box-shadow: 0px 0px 15px #83A; -khtml-box-shadow: 0px 0px 15px #83A; border: 1px solid #A6D ! important; display: inline-block; position: absolute}
.MathJax_Menu_Button .MathJax_Hover_Arrow {position: absolute; cursor: pointer; display: inline-block; border: 2px solid #AAA; border-radius: 4px; -webkit-border-radius: 4px; -moz-border-radius: 4px; -khtml-border-radius: 4px; font-family: 'Courier New',Courier; font-size: 9px; color: #F0F0F0}
.MathJax_Menu_Button .MathJax_Hover_Arrow span {display: block; background-color: #AAA; border: 1px solid; border-radius: 3px; line-height: 0; padding: 4px}
.MathJax_Hover_Arrow:hover {color: white!important; border: 2px solid #CCC!important}
.MathJax_Hover_Arrow:hover span {background-color: #CCC!important}
</style><style type="text/css">#MathJax_About {position: fixed; left: 50%; width: auto; text-align: center; border: 3px outset; padding: 1em 2em; background-color: #DDDDDD; color: black; cursor: default; font-family: message-box; font-size: 120%; font-style: normal; text-indent: 0; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; z-index: 201; border-radius: 15px; -webkit-border-radius: 15px; -moz-border-radius: 15px; -khtml-border-radius: 15px; box-shadow: 0px 10px 20px #808080; -webkit-box-shadow: 0px 10px 20px #808080; -moz-box-shadow: 0px 10px 20px #808080; -khtml-box-shadow: 0px 10px 20px #808080; filter: progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true')}
#MathJax_About.MathJax_MousePost {outline: none}
.MathJax_Menu {position: absolute; background-color: white; color: black; width: auto; padding: 2px; border: 1px solid #CCCCCC; margin: 0; cursor: default; font: menu; text-align: left; text-indent: 0; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; z-index: 201; box-shadow: 0px 10px 20px #808080; -webkit-box-shadow: 0px 10px 20px #808080; -moz-box-shadow: 0px 10px 20px #808080; -khtml-box-shadow: 0px 10px 20px #808080; filter: progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true')}
.MathJax_MenuItem {padding: 2px 2em; background: transparent}
.MathJax_MenuArrow {position: absolute; right: .5em; padding-top: .25em; color: #666666; font-size: .75em}
.MathJax_MenuActive .MathJax_MenuArrow {color: white}
.MathJax_MenuArrow.RTL {left: .5em; right: auto}
.MathJax_MenuCheck {position: absolute; left: .7em}
.MathJax_MenuCheck.RTL {right: .7em; left: auto}
.MathJax_MenuRadioCheck {position: absolute; left: 1em}
.MathJax_MenuRadioCheck.RTL {right: 1em; left: auto}
.MathJax_MenuLabel {padding: 2px 2em 4px 1.33em; font-style: italic}
.MathJax_MenuRule {border-top: 1px solid #CCCCCC; margin: 4px 1px 0px}
.MathJax_MenuDisabled {color: GrayText}
.MathJax_MenuActive {background-color: Highlight; color: HighlightText}
.MathJax_MenuDisabled:focus, .MathJax_MenuLabel:focus {background-color: #E8E8E8}
.MathJax_ContextMenu:focus {outline: none}
.MathJax_ContextMenu .MathJax_MenuItem:focus {outline: none}
#MathJax_AboutClose {top: .2em; right: .2em}
.MathJax_Menu .MathJax_MenuClose {top: -10px; left: -10px}
.MathJax_MenuClose {position: absolute; cursor: pointer; display: inline-block; border: 2px solid #AAA; border-radius: 18px; -webkit-border-radius: 18px; -moz-border-radius: 18px; -khtml-border-radius: 18px; font-family: 'Courier New',Courier; font-size: 24px; color: #F0F0F0}
.MathJax_MenuClose span {display: block; background-color: #AAA; border: 1.5px solid; border-radius: 18px; -webkit-border-radius: 18px; -moz-border-radius: 18px; -khtml-border-radius: 18px; line-height: 0; padding: 8px 0 6px}
.MathJax_MenuClose:hover {color: white!important; border: 2px solid #CCC!important}
.MathJax_MenuClose:hover span {background-color: #CCC!important}
.MathJax_MenuClose:hover:focus {outline: none}
</style><style type="text/css">.MathJax_Preview .MJXf-math {color: inherit!important}
</style><style type="text/css">.MJX_Assistive_MathML {position: absolute!important; top: 0; left: 0; clip: rect(1px, 1px, 1px, 1px); padding: 1px 0 0 0!important; border: 0!important; height: 1px!important; width: 1px!important; overflow: hidden!important; display: block!important; -webkit-touch-callout: none; -webkit-user-select: none; -khtml-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none}
.MJX_Assistive_MathML.MJX_Assistive_MathML_Block {width: 100%!important}
</style><style type="text/css">#MathJax_Zoom {position: absolute; background-color: #F0F0F0; overflow: auto; display: block; z-index: 301; padding: .5em; border: 1px solid black; margin: 0; font-weight: normal; font-style: normal; text-align: left; text-indent: 0; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; -webkit-box-sizing: content-box; -moz-box-sizing: content-box; box-sizing: content-box; box-shadow: 5px 5px 15px #AAAAAA; -webkit-box-shadow: 5px 5px 15px #AAAAAA; -moz-box-shadow: 5px 5px 15px #AAAAAA; -khtml-box-shadow: 5px 5px 15px #AAAAAA; filter: progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true')}
#MathJax_ZoomOverlay {position: absolute; left: 0; top: 0; z-index: 300; display: inline-block; width: 100%; height: 100%; border: 0; padding: 0; margin: 0; background-color: white; opacity: 0; filter: alpha(opacity=0)}
#MathJax_ZoomFrame {position: relative; display: inline-block; height: 0; width: 0}
#MathJax_ZoomEventTrap {position: absolute; left: 0; top: 0; z-index: 302; display: inline-block; border: 0; padding: 0; margin: 0; background-color: white; opacity: 0; filter: alpha(opacity=0)}
</style><style type="text/css">.MathJax_Preview {color: #888}
#MathJax_Message {position: fixed; left: 1px; bottom: 2px; background-color: #E6E6E6; border: 1px solid #959595; margin: 0px; padding: 2px 8px; z-index: 102; color: black; font-size: 80%; width: auto; white-space: nowrap}
#MathJax_MSIE_Frame {position: absolute; top: 0; left: 0; width: 0px; z-index: 101; border: 0px; margin: 0px; padding: 0px}
.MathJax_Error {color: #CC0000; font-style: italic}
</style><style type="text/css">.MJXp-script {font-size: .8em}
.MJXp-right {-webkit-transform-origin: right; -moz-transform-origin: right; -ms-transform-origin: right; -o-transform-origin: right; transform-origin: right}
.MJXp-bold {font-weight: bold}
.MJXp-italic {font-style: italic}
.MJXp-scr {font-family: MathJax_Script,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-frak {font-family: MathJax_Fraktur,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-sf {font-family: MathJax_SansSerif,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-cal {font-family: MathJax_Caligraphic,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-mono {font-family: MathJax_Typewriter,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-largeop {font-size: 150%}
.MJXp-largeop.MJXp-int {vertical-align: -.2em}
.MJXp-math {display: inline-block; line-height: 1.2; text-indent: 0; font-family: 'Times New Roman',Times,STIXGeneral,serif; white-space: nowrap; border-collapse: collapse}
.MJXp-display {display: block; text-align: center; margin: 1em 0}
.MJXp-math span {display: inline-block}
.MJXp-box {display: block!important; text-align: center}
.MJXp-box:after {content: " "}
.MJXp-rule {display: block!important; margin-top: .1em}
.MJXp-char {display: block!important}
.MJXp-mo {margin: 0 .15em}
.MJXp-mfrac {margin: 0 .125em; vertical-align: .25em}
.MJXp-denom {display: inline-table!important; width: 100%}
.MJXp-denom > * {display: table-row!important}
.MJXp-surd {vertical-align: top}
.MJXp-surd > * {display: block!important}
.MJXp-script-box > *  {display: table!important; height: 50%}
.MJXp-script-box > * > * {display: table-cell!important; vertical-align: top}
.MJXp-script-box > *:last-child > * {vertical-align: bottom}
.MJXp-script-box > * > * > * {display: block!important}
.MJXp-mphantom {visibility: hidden}
.MJXp-munderover {display: inline-table!important}
.MJXp-over {display: inline-block!important; text-align: center}
.MJXp-over > * {display: block!important}
.MJXp-munderover > * {display: table-row!important}
.MJXp-mtable {vertical-align: .25em; margin: 0 .125em}
.MJXp-mtable > * {display: inline-table!important; vertical-align: middle}
.MJXp-mtr {display: table-row!important}
.MJXp-mtd {display: table-cell!important; text-align: center; padding: .5em 0 0 .5em}
.MJXp-mtr > .MJXp-mtd:first-child {padding-left: 0}
.MJXp-mtr:first-child > .MJXp-mtd {padding-top: 0}
.MJXp-mlabeledtr {display: table-row!important}
.MJXp-mlabeledtr > .MJXp-mtd:first-child {padding-left: 0}
.MJXp-mlabeledtr:first-child > .MJXp-mtd {padding-top: 0}
.MJXp-merror {background-color: #FFFF88; color: #CC0000; border: 1px solid #CC0000; padding: 1px 3px; font-style: normal; font-size: 90%}
.MJXp-scale0 {-webkit-transform: scaleX(.0); -moz-transform: scaleX(.0); -ms-transform: scaleX(.0); -o-transform: scaleX(.0); transform: scaleX(.0)}
.MJXp-scale1 {-webkit-transform: scaleX(.1); -moz-transform: scaleX(.1); -ms-transform: scaleX(.1); -o-transform: scaleX(.1); transform: scaleX(.1)}
.MJXp-scale2 {-webkit-transform: scaleX(.2); -moz-transform: scaleX(.2); -ms-transform: scaleX(.2); -o-transform: scaleX(.2); transform: scaleX(.2)}
.MJXp-scale3 {-webkit-transform: scaleX(.3); -moz-transform: scaleX(.3); -ms-transform: scaleX(.3); -o-transform: scaleX(.3); transform: scaleX(.3)}
.MJXp-scale4 {-webkit-transform: scaleX(.4); -moz-transform: scaleX(.4); -ms-transform: scaleX(.4); -o-transform: scaleX(.4); transform: scaleX(.4)}
.MJXp-scale5 {-webkit-transform: scaleX(.5); -moz-transform: scaleX(.5); -ms-transform: scaleX(.5); -o-transform: scaleX(.5); transform: scaleX(.5)}
.MJXp-scale6 {-webkit-transform: scaleX(.6); -moz-transform: scaleX(.6); -ms-transform: scaleX(.6); -o-transform: scaleX(.6); transform: scaleX(.6)}
.MJXp-scale7 {-webkit-transform: scaleX(.7); -moz-transform: scaleX(.7); -ms-transform: scaleX(.7); -o-transform: scaleX(.7); transform: scaleX(.7)}
.MJXp-scale8 {-webkit-transform: scaleX(.8); -moz-transform: scaleX(.8); -ms-transform: scaleX(.8); -o-transform: scaleX(.8); transform: scaleX(.8)}
.MJXp-scale9 {-webkit-transform: scaleX(.9); -moz-transform: scaleX(.9); -ms-transform: scaleX(.9); -o-transform: scaleX(.9); transform: scaleX(.9)}
.MathJax_PHTML .noError {vertical-align: ; font-size: 90%; text-align: left; color: black; padding: 1px 3px; border: 1px solid}
</style><style type="text/css">#ya-site-form0,#ya-site-form0 .ya-site-form__form,#ya-site-form0 .ya-site-form__input,#ya-site-form0 .ya-site-form__input-text,#ya-site-form0 .ya-site-form__submit,#ya-site-form0 .ya-site-form__search-precise{font-size:12px!important;color:#000!important}#ya-site-form0 .ya-site-form__form-form{display:block}#ya-site-form0 .ya-site-form__form-form,#ya-site-form0 .ya-site-form__input,#ya-site-form0 .ya-site-form__search-precise,#ya-site-form0 .ya-site-form__search-precise__radio,#ya-site-form0 .ya-site-form__gap,#ya-site-form0 .ya-site-form__gap-i,#ya-site-form0 .ya-site-form__logo-img{margin:0;padding:0}#ya-site-form0{margin:0!important;padding:0!important}#ya-site-form0 .ya-site-form__logo-wrap{width:65px;vertical-align:top;border-collapse:collapse}#ya-site-form0 .ya-site-form__logo{display:block;width:52px;margin:0;padding:0 6px 0 0;text-decoration:none}#ya-site-form0 .ya-site-form__logo-img{width:52px;height:21px;border:0!important}#ya-site-form0 .ya-site-form__search-wrap{border-collapse:collapse}#ya-site-form0 .ya-site-form__search{font-size:12px!important;width:100%}#ya-site-form0 .ya-site-form__search-input,#ya-site-form0 .ya-site-form__search-precise,{border:0}#ya-site-form0 .ya-site-form__search-input{padding:6px}#ya-site-form0 .ya-site-form__search-input-layout,#ya-site-form0 .ya-site-form__search-input-layout-l,#ya-site-form0 .ya-site-form__search-input-layout-r{font-size:12px!important;padding:0;vertical-align:middle;border:0;border-collapse:collapse}#ya-site-form0 .ya-site-form__search-input-layout,#ya-site-form0 .ya-site-form__search-input-layout-l{width:100%}#ya-site-form0 .ya-site-form__search-precise{padding:0 18px 5px 6px;text-align:left;vertical-align:top}#ya-site-form0 .ya-site-form__search-precise-i{white-space:nowrap}#ya-site-form0 .ya-site-form__search-precise__radio{width:auto;margin:0 .3em 0 0;vertical-align:middle;background:none}#ya-site-form0 .ya-site-form__search-precise__label{margin:0 .4em 0 0;padding:0;vertical-align:middle}#ya-site-form0 .ya-site-form__input-text{width:100%;margin:0!important;cursor:text;-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;background-color:#fff;border:1px solid #7f9db9;outline-style:none;-webkit-appearance:textfield}#ya-site-form0 .ya-site-form__input-text_type_hint{background-repeat:no-repeat;background-position:.2em 50%}#ya-site-form0 .ya-site-form__submit{display:block;width:auto;margin:0 0 0 5px}#ya-site-form0 .ya-site-form__arrow-wrap{overflow:hidden;width:30px;padding:0;vertical-align:middle}#ya-site-form0 .ya-site-form__arrow{position:relative}#ya-site-form0 .ya-site-form__arrow-a{position:absolute;top:50%;right:0;width:0;height:0;margin-top:-59px;border:solid transparent;border-width:59px 0 59px 30px;-moz-border-end-style:dotted}#ya-site-form0 .ya-site-form__wrap{width:100%;table-layout:fixed;border-collapse:collapse}#ya-site-form0 .ya-site-form__gap{border:0}#ya-site-form0 .ya-site-form__gap-i{width:9em}#ya-site-form0.ya-site-form_arrow_yes .ya-site-form__search-input{padding-right:0}#ya-site-form0.ya-site-form_logo_left .ya-site-form__logo{margin-top:4px;margin-left:5px}#ya-site-form0.ya-site-form_logo_top .ya-site-form__logo{display:block;margin:6px 0 0 6px}#ya-site-form0 .ya-site-form__submit_type_image{width:19px;height:15px;outline:none;cursor:pointer;border:0}#ya-site-form0 .ya-site-form__submit_type_image { background: url(https://site.yandex.net/v2.0/i/en/search.png) no-repeat }#ya-site-form0 .ya-site-form__input-text_type_hint { background-image:url(https://site.yandex.net/v2.0/i/en/yandex-hint-rb.png) }#ya-site-form0 .ya-site-form__form * { font-size: 12px !important }#ya-site-form0 .ya-site-form__form .ya-site-form__input-text { font-style: normal!important }#ya-site-form0 .ya-site-form__form .ya-site-form__input-text { font-weight: normal!important }#ya-site-form0 .ya-site-form__form .ya-site-form__input-text { color: #000000!important }#ya-site-form0 .ya-site-form__form .ya-site-form__input-text { border-color: #7f9db9!important }#ya-site-form0 .ya-site-form__form .ya-site-form__input-text:focus { border-color: #7f9db9!important }#ya-site-form0 .ya-site-form__form .ya-site-form__input-text { background-color: #ffffff!important }#ya-site-form0 .ya-site-form__search, #ya-site-form0 .ya-site-form__search td, #ya-site-form0 .yaform__precise-i { background-color: transparent !important }#ya-site-form0 .ya-site-form__search-precise__label { color:#000000 !important }#ya-site-form0 .ya-site-form__arrow-a { border-left-color: transparent }</style><link title="search e-maxx-eng" rel="search" type="application/opensearchdescription+xml" href="https://yandex.com/search/site/opensearch.xml?ShortName=search%20e-maxx-eng&amp;InputEncoding=utf-8&amp;Image=&amp;Url-results=https%3A%2F%2Fe-maxx-eng.appspot.com%2Fsearch-results.html%3Fsearchid%3D2314495%26web%3D0%26text%3D%7BsearchTerms%7D&amp;Url-suggest=https%3A%2F%2Fsitesearch-suggest.yandex.ru%2Fv1%2Fsuggest%3F%26site%3D2314495%26lang%3Den%26part%3D%7BsearchTerms%7D&amp;Url-opensearchdescr=https%3A%2F%2Fyandex.com%2Fsearch%2Fsite%2Fopensearch.xml%3FShortName%3Dsearch%2520e-maxx-eng%26InputEncoding%3Dutf-8%26Image%3D%26Url-results%3Dhttps%253A%252F%252Fe-maxx-eng.appspot.com%252Fsearch-results.html%253Fsearchid%253D2314495%2526web%253D0%2526text%253D%257BsearchTerms%257D%26Url-suggest%3Dhttps%253A%252F%252Fsitesearch-suggest.yandex.ru%252Fv1%252Fsuggest%253F%2526site%253D2314495%2526lang%253Den%2526part%253D%257BsearchTerms%257D"><style type="text/css">#ya-site-form0 .ya-site-suggest{position:relative;margin:0}#ya-site-form0 .ya-site-suggest-popup{position:absolute;width:100%}#ya-site-form0 .ya-site-suggest__opera-gap{position:absolute;height:25em;border:1px solid transparent}#ya-site-form0 .ya-site-suggest-list{position:absolute;z-index:9999;overflow:hidden;min-width:25em;width:100%;margin-top:-1px;border-collapse:separate;-webkit-box-shadow:0 1px 7px #9a9a9a;-moz-box-shadow:0 1px 7px #9a9a9a;box-shadow:0 1px 7px #9a9a9a;border:1px solid #dedede;border-color:rgba(154,154,154,0.5);border-top-color:rgba(154,154,154,0.4);border-bottom-color:rgba(154,154,154,0.6)}#ya-site-form0 .ya-site-suggest-list{box-sizing:border-box;-moz-box-sizing:border-box;-webkit-box-sizing:border-box}#ya-site-form0 .ya-site-suggest__iframe{position:absolute;z-index:-1;min-width:25em;width:100%;height:100%;background:#fff}#ya-site-form0 .ya-site-suggest-items{font-size:16px;min-width:25em;width:100%;margin:0;padding:0 1px 0 0;list-style:none}#ya-site-form0 .ya-site-suggest-items li{margin:0;padding:0;line-height:normal}#ya-site-form0 .ya-site-suggest-elem{display:block;padding:.25em .3em;cursor:pointer;background:url()}#ya-site-form0 a.ya-site-suggest-elem:link,#ya-site-form0 a.ya-site-suggest-elem:visited{text-decoration:none}html body #ya-site-form0 .ya-site-suggest-elem:link,html body #ya-site-form0 .ya-site-suggest-elem-link{color:#000!important}#ya-site-form0 .ya-site-suggest-elem:hover,html body #ya-site-form0 .ya-site-suggest-elem_state_hover{background:#fef6d7}#ya-site-form0 .ya-site-suggest-elem_nav:hover,#ya-site-form0 .ya-site-suggest-elem_translate:hover{text-decoration:none;color:#000!important}#ya-site-form0 .ya-site-suggest-elem_nav .ya-site-suggest__link{text-decoration:underline;color:#1a3dc1}#ya-site-form0 .ya-site-suggest-elem_translate .ya-site-suggest__link{text-decoration:underline;color:#000}#ya-site-form0 .ya-site-suggest-elem .ya-site-suggest__info{white-space:nowrap;color:#666}#ya-site-form0 .ya-site-suggest-elem_selected{background:#fdedaf}#ya-site-form0 .ya-site-suggest__fact{color:#555}#ya-site-form0 .ya-site-suggest__highlight{font-weight:bold}</style><style type="text/css">.MathJax_Display {text-align: center; margin: 1em 0em; position: relative; display: block!important; text-indent: 0; max-width: none; max-height: none; min-width: 0; min-height: 0; width: 100%}
.MathJax .merror {background-color: #FFFF88; color: #CC0000; border: 1px solid #CC0000; padding: 1px 3px; font-style: normal; font-size: 90%}
.MathJax .MJX-monospace {font-family: monospace}
.MathJax .MJX-sans-serif {font-family: sans-serif}
#MathJax_Tooltip {background-color: InfoBackground; color: InfoText; border: 1px solid black; box-shadow: 2px 2px 5px #AAAAAA; -webkit-box-shadow: 2px 2px 5px #AAAAAA; -moz-box-shadow: 2px 2px 5px #AAAAAA; -khtml-box-shadow: 2px 2px 5px #AAAAAA; filter: progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true'); padding: 3px 4px; z-index: 401; position: absolute; left: 0; top: 0; width: auto; height: auto; display: none}
.MathJax {display: inline; font-style: normal; font-weight: normal; line-height: normal; font-size: 100%; font-size-adjust: none; text-indent: 0; text-align: left; text-transform: none; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; direction: ltr; max-width: none; max-height: none; min-width: 0; min-height: 0; border: 0; padding: 0; margin: 0}
.MathJax:focus, body :focus .MathJax {display: inline-table}
.MathJax.MathJax_FullWidth {text-align: center; display: table-cell!important; width: 10000em!important}
.MathJax img, .MathJax nobr, .MathJax a {border: 0; padding: 0; margin: 0; max-width: none; max-height: none; min-width: 0; min-height: 0; vertical-align: 0; line-height: normal; text-decoration: none}
img.MathJax_strut {border: 0!important; padding: 0!important; margin: 0!important; vertical-align: 0!important}
.MathJax span {display: inline; position: static; border: 0; padding: 0; margin: 0; vertical-align: 0; line-height: normal; text-decoration: none}
.MathJax nobr {white-space: nowrap!important}
.MathJax img {display: inline!important; float: none!important}
.MathJax * {transition: none; -webkit-transition: none; -moz-transition: none; -ms-transition: none; -o-transition: none}
.MathJax_Processing {visibility: hidden; position: fixed; width: 0; height: 0; overflow: hidden}
.MathJax_Processed {display: none!important}
.MathJax_ExBox {display: block!important; overflow: hidden; width: 1px; height: 60ex; min-height: 0; max-height: none}
.MathJax .MathJax_EmBox {display: block!important; overflow: hidden; width: 1px; height: 60em; min-height: 0; max-height: none}
.MathJax_LineBox {display: table!important}
.MathJax_LineBox span {display: table-cell!important; width: 10000em!important; min-width: 0; max-width: none; padding: 0; border: 0; margin: 0}
.MathJax .MathJax_HitBox {cursor: text; background: white; opacity: 0; filter: alpha(opacity=0)}
.MathJax .MathJax_HitBox * {filter: none; opacity: 1; background: transparent}
#MathJax_Tooltip * {filter: none; opacity: 1; background: transparent}
@font-face {font-family: MathJax_Main; src: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/woff/MathJax_Main-Regular.woff?V=2.7.1') format('woff'), url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/otf/MathJax_Main-Regular.otf?V=2.7.1') format('opentype')}
@font-face {font-family: MathJax_Main; src: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/woff/MathJax_Main-Bold.woff?V=2.7.1') format('woff'), url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/otf/MathJax_Main-Bold.otf?V=2.7.1') format('opentype'); font-weight: bold}
@font-face {font-family: MathJax_Main; src: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/woff/MathJax_Main-Italic.woff?V=2.7.1') format('woff'), url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/otf/MathJax_Main-Italic.otf?V=2.7.1') format('opentype'); font-style: italic}
@font-face {font-family: MathJax_Math; src: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/woff/MathJax_Math-Italic.woff?V=2.7.1') format('woff'), url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/otf/MathJax_Math-Italic.otf?V=2.7.1') format('opentype'); font-style: italic}
@font-face {font-family: MathJax_Caligraphic; src: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/woff/MathJax_Caligraphic-Regular.woff?V=2.7.1') format('woff'), url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/otf/MathJax_Caligraphic-Regular.otf?V=2.7.1') format('opentype')}
@font-face {font-family: MathJax_Size1; src: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/woff/MathJax_Size1-Regular.woff?V=2.7.1') format('woff'), url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/otf/MathJax_Size1-Regular.otf?V=2.7.1') format('opentype')}
@font-face {font-family: MathJax_Size2; src: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/woff/MathJax_Size2-Regular.woff?V=2.7.1') format('woff'), url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/otf/MathJax_Size2-Regular.otf?V=2.7.1') format('opentype')}
@font-face {font-family: MathJax_Size3; src: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/woff/MathJax_Size3-Regular.woff?V=2.7.1') format('woff'), url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/otf/MathJax_Size3-Regular.otf?V=2.7.1') format('opentype')}
@font-face {font-family: MathJax_Size4; src: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/woff/MathJax_Size4-Regular.woff?V=2.7.1') format('woff'), url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/otf/MathJax_Size4-Regular.otf?V=2.7.1') format('opentype')}
.MathJax .noError {vertical-align: ; font-size: 90%; text-align: left; color: black; padding: 1px 3px; border: 1px solid}
</style></head>
<body data-v="2018-05-11:604/214 2018-05-10:487/233 2018-05-09:620/235 2018-05-08:476/237 2018-05-07:652/236 2018-05-06:481/236 2018-05-05:626/266" class="vsc-initialized"><div style="visibility: hidden; overflow: hidden; position: absolute; top: 0px; height: 1px; width: auto; padding: 0px; border: 0px none; margin: 0px; text-align: left; text-indent: 0px; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal;"><div id="MathJax_Hidden"></div></div><div id="MathJax_Message" style="display: none;"></div>
<div id="container">
    <div id="navbar">
        <span id="title">
            <a href="https://e-maxx-eng.appspot.com/">MAXimal</a>
        </span>
        <span id="menu">
            <a href="https://github.com/e-maxx-eng/e-maxx-eng/commits/master/src/combinatorics/bracket_sequences.md" title="Changes History">Page Authors</a>
        </span>
        <span id="search" style="display:inline-block;width:200px;float:right;margin-top:7px;margin-right:20px;">
            <div class="ya-site-form ya-site-form_bg_transparent ya-site-form_logo_hint ya-site-form_inited_yes" id="ya-site-form0"><div class="ya-site-form__form"><table class="ya-site-form__wrap" cellspacing="0" cellpadding="0"><tbody><tr><td class="ya-site-form__search-wrap"><table class="ya-site-form__search" cellspacing="0" cellpadding="0"><tbody><tr><td class="ya-site-form__search-input"><table class="ya-site-form__search-input-layout"><tbody><tr><td class="ya-site-form__search-input-layout-l"><div class="ya-site-form__input"><input name="text" class="ya-site-form__input-text ya-site-form__input-text_type_hint" autocomplete="off" type="search"><div class="ya-site-suggest"><div class="ya-site-suggest-popup" style="display: none;"><i class="ya-site-suggest__opera-gap"></i><div class="ya-site-suggest-list"><div class="ya-site-suggest__iframe"></div><ul class="ya-site-suggest-items"></ul></div></div></div></div></td><td class="ya-site-form__search-input-layout-r"><input class="ya-site-form__submit" value="Search" type="button"></td></tr></tbody></table></td></tr><tr><td class="ya-site-form__gap"><div class="ya-site-form__gap-i"></div></td></tr></tbody></table></td></tr></tbody></table></div></div><style type="text/css">.ya-page_js_yes .ya-site-form_inited_no { display: none; }</style><script type="text/javascript">(function(w,d,c){var s=d.createElement('script'),h=d.getElementsByTagName('script')[0],e=d.documentElement;if((' '+e.className+' ').indexOf(' ya-page_js_yes ')===-1){e.className+=' ya-page_js_yes';}s.type='text/javascript';s.async=true;s.charset='utf-8';s.src=(d.location.protocol==='https:'?'https:':'http:')+'//site.yandex.net/v2.0/js/all.js';h.parentNode.insertBefore(s,h);(w[c]||(w[c]=[])).push(function(){Ya.Site.Form.init()})})(window,document,'yandex_site_callbacks');</script>
        </span>
    </div>
<h1>Balanced bracket sequences</h1><div id="toc"><strong>Table of Contents</strong><br><div class="toc-H2"><a href="https://e-maxx-eng.appspot.com/combinatorics/bracket_sequences.html#toc-tgt-0">Balance validation</a><a></a></div><div class="toc-H2"><a href="https://e-maxx-eng.appspot.com/combinatorics/bracket_sequences.html#toc-tgt-1">Number of balanced sequences</a><a></a></div><div class="toc-H3"><a href="https://e-maxx-eng.appspot.com/combinatorics/bracket_sequences.html#toc-tgt-2">Formula</a><a></a></div><div class="toc-H3"><a href="https://e-maxx-eng.appspot.com/combinatorics/bracket_sequences.html#toc-tgt-3">Dynamic programming</a><a></a></div><div class="toc-H2"><a href="https://e-maxx-eng.appspot.com/combinatorics/bracket_sequences.html#toc-tgt-4">Finding the lexicographical next balanced sequence</a><a></a></div><div class="toc-H2"><a href="https://e-maxx-eng.appspot.com/combinatorics/bracket_sequences.html#toc-tgt-5">Finding all balanced sequences</a><a></a></div><div class="toc-H2"><a href="https://e-maxx-eng.appspot.com/combinatorics/bracket_sequences.html#toc-tgt-6">Sequence index</a><a></a></div><div class="toc-H2"><a href="https://e-maxx-eng.appspot.com/combinatorics/bracket_sequences.html#toc-tgt-7">Finding the <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-1-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;k&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1" style="width: 0.677em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.551em; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(1.389em, 1000.53em, 2.462em, -1000em); top: -2.267em; left: 0em;"><span class="mrow" id="MathJax-Span-2"><span class="mi" id="MathJax-Span-3" style="font-family: MathJax_Math; font-style: italic;">k</span></span><span style="display: inline-block; width: 0px; height: 2.267em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.087em; border-left: 0px solid; width: 0px; height: 0.993em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>k</mi></math></span></span><script type="math/tex" id="MathJax-Element-1">k</script>-th sequence</a><a></a></div></div>

<p>A <strong>balanced bracket sequence</strong> is a string consisting 
of only brackets, such that this sequence, when inserted certain numbers
 and mathematical operations, gives a valid mathematical expression.
Formally you can define balanced bracket sequence with:</p>

<ul>
<li><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-2-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;e&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-4" style="width: 0.576em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.469em; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(1.693em, 1000.43em, 2.459em, -1000em); top: -2.292em; left: 0em;"><span class="mrow" id="MathJax-Span-5"><span class="mi" id="MathJax-Span-6" style="font-family: MathJax_Math; font-style: italic;">e</span></span><span style="display: inline-block; width: 0px; height: 2.292em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.076em; border-left: 0px solid; width: 0px; height: 0.669em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>e</mi></math></span></span><script type="math/tex" id="MathJax-Element-2">e</script> (the empty string) is a balanced bracket sequence.</li>
<li>if <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-3-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-7" style="width: 0.576em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.469em; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(1.693em, 1000.42em, 2.458em, -1000em); top: -2.292em; left: 0em;"><span class="mrow" id="MathJax-Span-8"><span class="mi" id="MathJax-Span-9" style="font-family: MathJax_Math; font-style: italic;">s</span></span><span style="display: inline-block; width: 0px; height: 2.292em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.074em; border-left: 0px solid; width: 0px; height: 0.667em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>s</mi></math></span></span><script type="math/tex" id="MathJax-Element-3">s</script> is a balanced bracket sequence, then so is <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-4-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-10" style="width: 1.513em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.25em; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(1.385em, 1001.16em, 2.698em, -1000em); top: -2.292em; left: 0em;"><span class="mrow" id="MathJax-Span-11"><span class="mo" id="MathJax-Span-12" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-13" style="font-family: MathJax_Math; font-style: italic;">s</span><span class="mo" id="MathJax-Span-14" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.292em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.362em; border-left: 0px solid; width: 0px; height: 1.325em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo stretchy="false">(</mo><mi>s</mi><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-4">(s)</script>.</li>
<li>if <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-5-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-15" style="width: 0.576em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.469em; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(1.693em, 1000.42em, 2.458em, -1000em); top: -2.292em; left: 0em;"><span class="mrow" id="MathJax-Span-16"><span class="mi" id="MathJax-Span-17" style="font-family: MathJax_Math; font-style: italic;">s</span></span><span style="display: inline-block; width: 0px; height: 2.292em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.074em; border-left: 0px solid; width: 0px; height: 0.667em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>s</mi></math></span></span><script type="math/tex" id="MathJax-Element-5">s</script> and <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-6-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-18" style="width: 0.471em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.365em; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(1.509em, 1000.33em, 2.459em, -1000em); top: -2.292em; left: 0em;"><span class="mrow" id="MathJax-Span-19"><span class="mi" id="MathJax-Span-20" style="font-family: MathJax_Math; font-style: italic;">t</span></span><span style="display: inline-block; width: 0px; height: 2.292em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.076em; border-left: 0px solid; width: 0px; height: 0.889em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>t</mi></math></span></span><script type="math/tex" id="MathJax-Element-6">t</script> are balanced bracket sequences, then so is <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-7-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-21" style="width: 1.044em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.833em; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(1.509em, 1000.8em, 2.459em, -1000em); top: -2.292em; left: 0em;"><span class="mrow" id="MathJax-Span-22"><span class="mi" id="MathJax-Span-23" style="font-family: MathJax_Math; font-style: italic;">s</span><span class="mi" id="MathJax-Span-24" style="font-family: MathJax_Math; font-style: italic;">t</span></span><span style="display: inline-block; width: 0px; height: 2.292em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.076em; border-left: 0px solid; width: 0px; height: 0.889em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>s</mi><mi>t</mi></math></span></span><script type="math/tex" id="MathJax-Element-7">s t</script>.</li>
</ul>

<p>For instance <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-8-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-25" style="width: 2.815em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.344em; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(1.281em, 1002.25em, 2.594em, -1000em); top: -2.188em; left: 0em;"><span class="mrow" id="MathJax-Span-26"><span class="mo" id="MathJax-Span-27" style="font-family: MathJax_Main;">(</span><span class="mo" id="MathJax-Span-28" style="font-family: MathJax_Main;">(</span><span class="mo" id="MathJax-Span-29" style="font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-30" style="font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-31" style="font-family: MathJax_Main;">(</span><span class="mo" id="MathJax-Span-32" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.188em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.362em; border-left: 0px solid; width: 0px; height: 1.325em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo stretchy="false">(</mo><mo stretchy="false">(</mo><mo stretchy="false">)</mo><mo stretchy="false">)</mo><mo stretchy="false">(</mo><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-8">(())()</script> is a balanced bracket sequence, but <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-9-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-33" style="width: 1.878em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.563em; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(1.281em, 1001.51em, 2.594em, -1000em); top: -2.188em; left: 0em;"><span class="mrow" id="MathJax-Span-34"><span class="mo" id="MathJax-Span-35" style="font-family: MathJax_Main;">(</span><span class="mo" id="MathJax-Span-36" style="font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-37" style="font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-38" style="font-family: MathJax_Main;">(</span></span><span style="display: inline-block; width: 0px; height: 2.188em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.362em; border-left: 0px solid; width: 0px; height: 1.325em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo stretchy="false">(</mo><mo stretchy="false">)</mo><mo stretchy="false">)</mo><mo stretchy="false">(</mo></math></span></span><script type="math/tex" id="MathJax-Element-9">())(</script> is not.</p>

<p>Of course you can define other bracket sequences also with multiple bracket types in a similar fashion.</p>

<p>In this article we discuss some classic problems involving balanced 
bracket sequences (for simplicity we will only call them sequences): 
validation, number of sequences, finding the lexicographical next 
sequence, generating all sequences of a certain size, finding the index 
of sequence, and generating the <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-10-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;k&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-39" style="width: 0.628em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.521em; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(1.441em, 1000.5em, 2.459em, -1000em); top: -2.292em; left: 0em;"><span class="mrow" id="MathJax-Span-40"><span class="mi" id="MathJax-Span-41" style="font-family: MathJax_Math; font-style: italic;">k</span></span><span style="display: inline-block; width: 0px; height: 2.292em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.076em; border-left: 0px solid; width: 0px; height: 0.971em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>k</mi></math></span></span><script type="math/tex" id="MathJax-Element-10">k</script>-th
 sequences.
We will also discuss two variations for the problems, the simpler 
version when only one type of brackets is allowed, and the harder case 
when there are multiple types.</p>

<h2 id="toc-tgt-0">Balance validation</h2>

<p>We want to check if a given string is balanced or not.</p>

<p>At first suppose there is only one type of bracket.
For this case there exists a very simple algorithm.
Let <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-11-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mtext&gt;depth&lt;/mtext&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-42" style="width: 3.023em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.5em; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(1.337em, 1002.49em, 2.538em, -1000em); top: -2.188em; left: 0em;"><span class="mrow" id="MathJax-Span-43"><span class="mtext" id="MathJax-Span-44" style="font-family: MathJax_Main;">depth</span></span><span style="display: inline-block; width: 0px; height: 2.188em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.295em; border-left: 0px solid; width: 0px; height: 1.191em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mtext>depth</mtext></math></span></span><script type="math/tex" id="MathJax-Element-11">\text{depth}</script> be the current number of open brackets.
Initially <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-12-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mtext&gt;depth&lt;/mtext&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mn&gt;0&lt;/mn&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-45" style="width: 5.211em; display: inline-block;"><span style="display: inline-block; position: relative; width: 4.323em; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(1.337em, 1004.28em, 2.538em, -1000em); top: -2.188em; left: 0em;"><span class="mrow" id="MathJax-Span-46"><span class="mtext" id="MathJax-Span-47" style="font-family: MathJax_Main;">depth</span><span class="mo" id="MathJax-Span-48" style="font-family: MathJax_Main; padding-left: 0.278em;">=</span><span class="mn" id="MathJax-Span-49" style="font-family: MathJax_Main; padding-left: 0.278em;">0</span></span><span style="display: inline-block; width: 0px; height: 2.188em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.295em; border-left: 0px solid; width: 0px; height: 1.191em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mtext>depth</mtext><mo>=</mo><mn>0</mn></math></span></span><script type="math/tex" id="MathJax-Element-12">\text{depth} = 0</script>.
We iterate over all character of the string, if the current bracket character is an opening bracket, then we increment <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-13-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mtext&gt;depth&lt;/mtext&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-50" style="width: 3.023em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.5em; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(1.337em, 1002.49em, 2.538em, -1000em); top: -2.188em; left: 0em;"><span class="mrow" id="MathJax-Span-51"><span class="mtext" id="MathJax-Span-52" style="font-family: MathJax_Main;">depth</span></span><span style="display: inline-block; width: 0px; height: 2.188em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.295em; border-left: 0px solid; width: 0px; height: 1.191em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mtext>depth</mtext></math></span></span><script type="math/tex" id="MathJax-Element-13">\text{depth}</script>, otherwise we decrement it.
If at any time the variable <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-14-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mtext&gt;depth&lt;/mtext&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-53" style="width: 3.023em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.5em; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(1.337em, 1002.49em, 2.538em, -1000em); top: -2.188em; left: 0em;"><span class="mrow" id="MathJax-Span-54"><span class="mtext" id="MathJax-Span-55" style="font-family: MathJax_Main;">depth</span></span><span style="display: inline-block; width: 0px; height: 2.188em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.295em; border-left: 0px solid; width: 0px; height: 1.191em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mtext>depth</mtext></math></span></span><script type="math/tex" id="MathJax-Element-14">\text{depth}</script> gets negative, or at the end it is different from <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-15-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mn&gt;0&lt;/mn&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-56" style="width: 0.628em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.521em; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(1.365em, 1000.48em, 2.366em, -1000em); top: -2.188em; left: 0em;"><span class="mrow" id="MathJax-Span-57"><span class="mn" id="MathJax-Span-58" style="font-family: MathJax_Main;">0</span></span><span style="display: inline-block; width: 0px; height: 2.188em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.089em; border-left: 0px solid; width: 0px; height: 0.951em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn>0</mn></math></span></span><script type="math/tex" id="MathJax-Element-15">0</script>, than the string is not a balances sequence.
Otherwise it is.</p>

<p>If there are several bracket types involved, then the algorithm needs to be changes.
Instead of a counter <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-16-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mtext&gt;depth&lt;/mtext&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-59" style="width: 3.023em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.5em; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(1.337em, 1002.49em, 2.538em, -1000em); top: -2.188em; left: 0em;"><span class="mrow" id="MathJax-Span-60"><span class="mtext" id="MathJax-Span-61" style="font-family: MathJax_Main;">depth</span></span><span style="display: inline-block; width: 0px; height: 2.188em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.295em; border-left: 0px solid; width: 0px; height: 1.191em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mtext>depth</mtext></math></span></span><script type="math/tex" id="MathJax-Element-16">\text{depth}</script>
 we create a stack, in which we will store all opening brackets that we 
meet.
If the current bracket character is an opening one, we put it onto the 
stack.
If is is a closing one, then we check if the stack is non-empty, and if 
the top element of the stack is of the same type as the current closing 
bracket.
If both conditions are fulfilled, then we remove the opening bracket 
from the stack.
If at any time one of the conditions is not fulfilled, or at the end the
 stack is not empty, then the string is not balanced.
Otherwise it is.</p>

<h2 id="toc-tgt-1">Number of balanced sequences</h2>

<h3 id="toc-tgt-2">Formula</h3>

<p>The number of balanced bracket sequences with only one bracket type can be calculated using the <a href="https://e-maxx-eng.appspot.com/combinatorics/catalan-numbers.html">Catalan numbers</a>.
The number of balanced bracket sequences of length <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-17-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-62" style="width: 1.357em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.094em; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(1.469em, 1001.07em, 2.459em, -1000em); top: -2.292em; left: 0em;"><span class="mrow" id="MathJax-Span-63"><span class="mn" id="MathJax-Span-64" style="font-family: MathJax_Main;">2</span><span class="mi" id="MathJax-Span-65" style="font-family: MathJax_Math; font-style: italic;">n</span></span><span style="display: inline-block; width: 0px; height: 2.292em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.076em; border-left: 0px solid; width: 0px; height: 0.937em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn>2</mn><mi>n</mi></math></span></span><script type="math/tex" id="MathJax-Element-17">2n</script> (<span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-18-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-66" style="width: 0.784em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.625em; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(1.693em, 1000.61em, 2.459em, -1000em); top: -2.292em; left: 0em;"><span class="mrow" id="MathJax-Span-67"><span class="mi" id="MathJax-Span-68" style="font-family: MathJax_Math; font-style: italic;">n</span></span><span style="display: inline-block; width: 0px; height: 2.292em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.076em; border-left: 0px solid; width: 0px; height: 0.669em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>n</mi></math></span></span><script type="math/tex" id="MathJax-Element-18">n</script> pairs of brackets) is:
<span class="MathJax_Preview" style="color: inherit; display: none;"></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-19-Frame" tabindex="0" style="text-align: center; position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;mfrac&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mrow&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/mrow&gt;&lt;/mfrac&gt;&lt;mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-OPEN&quot;&gt;&lt;mo maxsize=&quot;2.047em&quot; minsize=&quot;2.047em&quot;&gt;(&lt;/mo&gt;&lt;/mrow&gt;&lt;mfrac linethickness=&quot;0&quot;&gt;&lt;mrow&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;/mrow&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;/mfrac&gt;&lt;mrow class=&quot;MJX-TeXAtom-CLOSE&quot;&gt;&lt;mo maxsize=&quot;2.047em&quot; minsize=&quot;2.047em&quot;&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-69" style="width: 6.357em; display: inline-block;"><span style="display: inline-block; position: relative; width: 5.26em; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(1.832em, 1005.05em, 4.543em, -1000em); top: -3.438em; left: 0em;"><span class="mrow" id="MathJax-Span-70"><span class="mfrac" id="MathJax-Span-71"><span style="display: inline-block; position: relative; width: 2.442em; height: 0px; margin-right: 0.12em; margin-left: 0.12em;"><span style="position: absolute; clip: rect(3.188em, 1000.43em, 4.167em, -1000em); top: -4.687em; left: 50%; margin-left: -0.25em;"><span class="mn" id="MathJax-Span-72" style="font-family: MathJax_Main;">1</span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span><span style="position: absolute; clip: rect(3.188em, 1002.25em, 4.249em, -1000em); top: -3.324em; left: 50%; margin-left: -1.161em;"><span class="mrow" id="MathJax-Span-73"><span class="mi" id="MathJax-Span-74" style="font-family: MathJax_Math; font-style: italic;">n</span><span class="mo" id="MathJax-Span-75" style="font-family: MathJax_Main; padding-left: 0.222em;">+</span><span class="mn" id="MathJax-Span-76" style="font-family: MathJax_Main; padding-left: 0.222em;">1</span></span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span><span style="position: absolute; clip: rect(0.82em, 1002.44em, 1.198em, -1000em); top: -1.262em; left: 0em;"><span style="display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 2.442em; height: 0px;"></span><span style="display: inline-block; width: 0px; height: 1.042em;"></span></span></span></span><span class="mrow" id="MathJax-Span-77"><span class="TeXmathchoice" id="MathJax-Span-78"><span class="texatom" id="MathJax-Span-79"><span class="mrow" id="MathJax-Span-80"><span class="mo" id="MathJax-Span-81" style="vertical-align: 0em;"><span style="font-family: MathJax_Size3;">(</span></span></span></span></span><span class="mfrac" id="MathJax-Span-82"><span style="display: inline-block; position: relative; width: 1.1em; height: 0px;"><span style="position: absolute; clip: rect(3.188em, 1001.08em, 4.178em, -1000em); top: -4.687em; left: 50%; margin-left: -0.55em;"><span class="mrow" id="MathJax-Span-83"><span class="mn" id="MathJax-Span-84" style="font-family: MathJax_Main;">2</span><span class="mi" id="MathJax-Span-85" style="font-family: MathJax_Math; font-style: italic;">n</span></span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span><span style="position: absolute; clip: rect(3.412em, 1000.58em, 4.178em, -1000em); top: -3.324em; left: 50%; margin-left: -0.3em;"><span class="mi" id="MathJax-Span-86" style="font-family: MathJax_Math; font-style: italic;">n</span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span></span></span><span class="TeXmathchoice" id="MathJax-Span-87"><span class="texatom" id="MathJax-Span-88"><span class="mrow" id="MathJax-Span-89"><span class="mo" id="MathJax-Span-90" style="vertical-align: 0em;"><span style="font-family: MathJax_Size3;">)</span></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.438em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -1.202em; border-left: 0px solid; width: 0px; height: 3.004em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mfrac><mn>1</mn><mrow><mi>n</mi><mo>+</mo><mn>1</mn></mrow></mfrac><mrow><mrow class="MJX-TeXAtom-OPEN"><mo maxsize="2.047em" minsize="2.047em">(</mo></mrow><mfrac linethickness="0"><mrow><mn>2</mn><mi>n</mi></mrow><mi>n</mi></mfrac><mrow class="MJX-TeXAtom-CLOSE"><mo maxsize="2.047em" minsize="2.047em">)</mo></mrow></mrow></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-19">\frac{1}{n+1} \binom{2n}{n}</script></p>

<p>If we allow <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-20-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;k&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-91" style="width: 0.628em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.521em; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(1.441em, 1000.5em, 2.459em, -1000em); top: -2.292em; left: 0em;"><span class="mrow" id="MathJax-Span-92"><span class="mi" id="MathJax-Span-93" style="font-family: MathJax_Math; font-style: italic;">k</span></span><span style="display: inline-block; width: 0px; height: 2.292em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.076em; border-left: 0px solid; width: 0px; height: 0.971em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>k</mi></math></span></span><script type="math/tex" id="MathJax-Element-20">k</script> types of brackets, then each pair be of any of the <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-21-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;k&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-94" style="width: 0.628em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.521em; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(1.441em, 1000.5em, 2.459em, -1000em); top: -2.292em; left: 0em;"><span class="mrow" id="MathJax-Span-95"><span class="mi" id="MathJax-Span-96" style="font-family: MathJax_Math; font-style: italic;">k</span></span><span style="display: inline-block; width: 0px; height: 2.292em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.076em; border-left: 0px solid; width: 0px; height: 0.971em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>k</mi></math></span></span><script type="math/tex" id="MathJax-Element-21">k</script> types (independently of the others), thus the number of balanced bracket sequences is:
<span class="MathJax_Preview" style="color: inherit; display: none;"></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-22-Frame" tabindex="0" style="text-align: center; position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;mfrac&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mrow&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/mrow&gt;&lt;/mfrac&gt;&lt;mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-OPEN&quot;&gt;&lt;mo maxsize=&quot;2.047em&quot; minsize=&quot;2.047em&quot;&gt;(&lt;/mo&gt;&lt;/mrow&gt;&lt;mfrac linethickness=&quot;0&quot;&gt;&lt;mrow&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;/mrow&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;/mfrac&gt;&lt;mrow class=&quot;MJX-TeXAtom-CLOSE&quot;&gt;&lt;mo maxsize=&quot;2.047em&quot; minsize=&quot;2.047em&quot;&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;/mrow&gt;&lt;msup&gt;&lt;mi&gt;k&lt;/mi&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;/msup&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-97" style="width: 7.503em; display: inline-block;"><span style="display: inline-block; position: relative; width: 6.25em; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(1.832em, 1006.25em, 4.543em, -1000em); top: -3.438em; left: 0em;"><span class="mrow" id="MathJax-Span-98"><span class="mfrac" id="MathJax-Span-99"><span style="display: inline-block; position: relative; width: 2.442em; height: 0px; margin-right: 0.12em; margin-left: 0.12em;"><span style="position: absolute; clip: rect(3.188em, 1000.43em, 4.167em, -1000em); top: -4.687em; left: 50%; margin-left: -0.25em;"><span class="mn" id="MathJax-Span-100" style="font-family: MathJax_Main;">1</span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span><span style="position: absolute; clip: rect(3.188em, 1002.25em, 4.249em, -1000em); top: -3.324em; left: 50%; margin-left: -1.161em;"><span class="mrow" id="MathJax-Span-101"><span class="mi" id="MathJax-Span-102" style="font-family: MathJax_Math; font-style: italic;">n</span><span class="mo" id="MathJax-Span-103" style="font-family: MathJax_Main; padding-left: 0.222em;">+</span><span class="mn" id="MathJax-Span-104" style="font-family: MathJax_Main; padding-left: 0.222em;">1</span></span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span><span style="position: absolute; clip: rect(0.82em, 1002.44em, 1.198em, -1000em); top: -1.262em; left: 0em;"><span style="display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 2.442em; height: 0px;"></span><span style="display: inline-block; width: 0px; height: 1.042em;"></span></span></span></span><span class="mrow" id="MathJax-Span-105"><span class="TeXmathchoice" id="MathJax-Span-106"><span class="texatom" id="MathJax-Span-107"><span class="mrow" id="MathJax-Span-108"><span class="mo" id="MathJax-Span-109" style="vertical-align: 0em;"><span style="font-family: MathJax_Size3;">(</span></span></span></span></span><span class="mfrac" id="MathJax-Span-110"><span style="display: inline-block; position: relative; width: 1.1em; height: 0px;"><span style="position: absolute; clip: rect(3.188em, 1001.08em, 4.178em, -1000em); top: -4.687em; left: 50%; margin-left: -0.55em;"><span class="mrow" id="MathJax-Span-111"><span class="mn" id="MathJax-Span-112" style="font-family: MathJax_Main;">2</span><span class="mi" id="MathJax-Span-113" style="font-family: MathJax_Math; font-style: italic;">n</span></span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span><span style="position: absolute; clip: rect(3.412em, 1000.58em, 4.178em, -1000em); top: -3.324em; left: 50%; margin-left: -0.3em;"><span class="mi" id="MathJax-Span-114" style="font-family: MathJax_Math; font-style: italic;">n</span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span></span></span><span class="TeXmathchoice" id="MathJax-Span-115"><span class="texatom" id="MathJax-Span-116"><span class="mrow" id="MathJax-Span-117"><span class="mo" id="MathJax-Span-118" style="vertical-align: 0em;"><span style="font-family: MathJax_Size3;">)</span></span></span></span></span></span><span class="msubsup" id="MathJax-Span-119"><span style="display: inline-block; position: relative; width: 1.02em; height: 0px;"><span style="position: absolute; clip: rect(3.16em, 1000.5em, 4.178em, -1000em); top: -4.01em; left: 0em;"><span class="mi" id="MathJax-Span-120" style="font-family: MathJax_Math; font-style: italic;">k</span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span><span style="position: absolute; top: -4.423em; left: 0.521em;"><span class="mi" id="MathJax-Span-121" style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;">n</span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.438em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -1.202em; border-left: 0px solid; width: 0px; height: 3.004em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mfrac><mn>1</mn><mrow><mi>n</mi><mo>+</mo><mn>1</mn></mrow></mfrac><mrow><mrow class="MJX-TeXAtom-OPEN"><mo maxsize="2.047em" minsize="2.047em">(</mo></mrow><mfrac linethickness="0"><mrow><mn>2</mn><mi>n</mi></mrow><mi>n</mi></mfrac><mrow class="MJX-TeXAtom-CLOSE"><mo maxsize="2.047em" minsize="2.047em">)</mo></mrow></mrow><msup><mi>k</mi><mi>n</mi></msup></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-22">\frac{1}{n+1} \binom{2n}{n} k^n</script></p>

<h3 id="toc-tgt-3">Dynamic programming</h3>

<p>On the other hand these numbers can be computed using <strong>dynamic programming</strong>.
Let <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-23-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;d&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;[&lt;/mo&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;]&lt;/mo&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-122" style="width: 2.034em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.667em; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(1.385em, 1001.55em, 2.698em, -1000em); top: -2.292em; left: 0em;"><span class="mrow" id="MathJax-Span-123"><span class="mi" id="MathJax-Span-124" style="font-family: MathJax_Math; font-style: italic;">d<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-125" style="font-family: MathJax_Main;">[</span><span class="mi" id="MathJax-Span-126" style="font-family: MathJax_Math; font-style: italic;">n</span><span class="mo" id="MathJax-Span-127" style="font-family: MathJax_Main;">]</span></span><span style="display: inline-block; width: 0px; height: 2.292em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.362em; border-left: 0px solid; width: 0px; height: 1.325em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>d</mi><mo stretchy="false">[</mo><mi>n</mi><mo stretchy="false">]</mo></math></span></span><script type="math/tex" id="MathJax-Element-23">d[n]</script> be the number of regular bracket sequences with <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-24-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-128" style="width: 0.784em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.625em; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(1.693em, 1000.61em, 2.459em, -1000em); top: -2.292em; left: 0em;"><span class="mrow" id="MathJax-Span-129"><span class="mi" id="MathJax-Span-130" style="font-family: MathJax_Math; font-style: italic;">n</span></span><span style="display: inline-block; width: 0px; height: 2.292em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.076em; border-left: 0px solid; width: 0px; height: 0.669em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>n</mi></math></span></span><script type="math/tex" id="MathJax-Element-24">n</script>
 pairs of bracket.
Note that in the first position there is always an opening bracket.
And somewhere later is the corresponding closing bracket of the pair.
It is clear that inside this pair there is a balanced bracket sequence, 
and similarly after this pair there is a balanced bracket sequence.
So to compute <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-25-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;d&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;[&lt;/mo&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;]&lt;/mo&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-131" style="width: 2.034em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.667em; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(1.385em, 1001.55em, 2.698em, -1000em); top: -2.292em; left: 0em;"><span class="mrow" id="MathJax-Span-132"><span class="mi" id="MathJax-Span-133" style="font-family: MathJax_Math; font-style: italic;">d<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-134" style="font-family: MathJax_Main;">[</span><span class="mi" id="MathJax-Span-135" style="font-family: MathJax_Math; font-style: italic;">n</span><span class="mo" id="MathJax-Span-136" style="font-family: MathJax_Main;">]</span></span><span style="display: inline-block; width: 0px; height: 2.292em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.362em; border-left: 0px solid; width: 0px; height: 1.325em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>d</mi><mo stretchy="false">[</mo><mi>n</mi><mo stretchy="false">]</mo></math></span></span><script type="math/tex" id="MathJax-Element-25">d[n]</script>, we will look at how many balanced sequences of <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-26-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-137" style="width: 0.471em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.365em; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(1.474em, 1000.32em, 2.459em, -1000em); top: -2.292em; left: 0em;"><span class="mrow" id="MathJax-Span-138"><span class="mi" id="MathJax-Span-139" style="font-family: MathJax_Math; font-style: italic;">i</span></span><span style="display: inline-block; width: 0px; height: 2.292em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.076em; border-left: 0px solid; width: 0px; height: 0.931em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>i</mi></math></span></span><script type="math/tex" id="MathJax-Element-26">i</script> pairs of brackets are inside this first bracket pair, and how many balanced sequences with <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-27-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-140" style="width: 4.69em; display: inline-block;"><span style="display: inline-block; position: relative; width: 3.906em; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(1.469em, 1003.86em, 2.53em, -1000em); top: -2.292em; left: 0em;"><span class="mrow" id="MathJax-Span-141"><span class="mi" id="MathJax-Span-142" style="font-family: MathJax_Math; font-style: italic;">n</span><span class="mo" id="MathJax-Span-143" style="font-family: MathJax_Main; padding-left: 0.222em;"></span><span class="mn" id="MathJax-Span-144" style="font-family: MathJax_Main; padding-left: 0.222em;">1</span><span class="mo" id="MathJax-Span-145" style="font-family: MathJax_Main; padding-left: 0.222em;"></span><span class="mi" id="MathJax-Span-146" style="font-family: MathJax_Math; font-style: italic; padding-left: 0.222em;">i</span></span><span style="display: inline-block; width: 0px; height: 2.292em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.161em; border-left: 0px solid; width: 0px; height: 1.023em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>n</mi><mo></mo><mn>1</mn><mo></mo><mi>i</mi></math></span></span><script type="math/tex" id="MathJax-Element-27">n-1-i</script> pairs are after this pair.
Consequently the formula has the form:
<span class="MathJax_Preview" style="color: inherit; display: none;"></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-28-Frame" tabindex="0" style="text-align: center; position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;mi&gt;d&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;[&lt;/mo&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;]&lt;/mo&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;munderover&gt;&lt;mo&gt;&amp;#x2211;&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mn&gt;0&lt;/mn&gt;&lt;/mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/mrow&gt;&lt;/munderover&gt;&lt;mi&gt;d&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;[&lt;/mo&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;]&lt;/mo&gt;&lt;mo&gt;&amp;#x22C5;&lt;/mo&gt;&lt;mi&gt;d&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;[&lt;/mo&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;]&lt;/mo&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-147" style="width: 14.065em; display: inline-block;"><span style="display: inline-block; position: relative; width: 11.719em; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(0.414em, 1011.6em, 3.651em, -1000em); top: -2.292em; left: 0em;"><span class="mrow" id="MathJax-Span-148"><span class="mi" id="MathJax-Span-149" style="font-family: MathJax_Math; font-style: italic;">d<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-150" style="font-family: MathJax_Main;">[</span><span class="mi" id="MathJax-Span-151" style="font-family: MathJax_Math; font-style: italic;">n</span><span class="mo" id="MathJax-Span-152" style="font-family: MathJax_Main;">]</span><span class="mo" id="MathJax-Span-153" style="font-family: MathJax_Main; padding-left: 0.278em;">=</span><span class="munderover" id="MathJax-Span-154" style="padding-left: 0.278em;"><span style="display: inline-block; position: relative; width: 1.444em; height: 0px;"><span style="position: absolute; clip: rect(2.904em, 1001.39em, 4.617em, -1000em); top: -4.01em; left: 0em;"><span class="mo" id="MathJax-Span-155" style="font-family: MathJax_Size2; vertical-align: 0em;"></span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span><span style="position: absolute; clip: rect(3.383em, 1001.12em, 4.282em, -1000em); top: -2.923em; left: 0.148em;"><span class="texatom" id="MathJax-Span-156"><span class="mrow" id="MathJax-Span-157"><span class="mi" id="MathJax-Span-158" style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;">i</span><span class="mo" id="MathJax-Span-159" style="font-size: 70.7%; font-family: MathJax_Main;">=</span><span class="mn" id="MathJax-Span-160" style="font-size: 70.7%; font-family: MathJax_Main;">0</span></span></span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span><span style="position: absolute; clip: rect(3.283em, 1001.28em, 4.225em, -1000em); top: -5.16em; left: 0.058em;"><span class="texatom" id="MathJax-Span-161"><span class="mrow" id="MathJax-Span-162"><span class="mi" id="MathJax-Span-163" style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;">n</span><span class="mo" id="MathJax-Span-164" style="font-size: 70.7%; font-family: MathJax_Main;"></span><span class="mn" id="MathJax-Span-165" style="font-size: 70.7%; font-family: MathJax_Main;">1</span></span></span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span></span></span><span class="mi" id="MathJax-Span-166" style="font-family: MathJax_Math; font-style: italic; padding-left: 0.167em;">d<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-167" style="font-family: MathJax_Main;">[</span><span class="mi" id="MathJax-Span-168" style="font-family: MathJax_Math; font-style: italic;">i</span><span class="mo" id="MathJax-Span-169" style="font-family: MathJax_Main;">]</span><span class="mo" id="MathJax-Span-170" style="font-family: MathJax_Main; padding-left: 0.222em;"></span><span class="mi" id="MathJax-Span-171" style="font-family: MathJax_Math; font-style: italic; padding-left: 0.222em;">d<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-172" style="font-family: MathJax_Main;">[</span><span class="mi" id="MathJax-Span-173" style="font-family: MathJax_Math; font-style: italic;">n</span><span class="mo" id="MathJax-Span-174" style="font-family: MathJax_Main; padding-left: 0.222em;"></span><span class="mn" id="MathJax-Span-175" style="font-family: MathJax_Main; padding-left: 0.222em;">1</span><span class="mo" id="MathJax-Span-176" style="font-family: MathJax_Main; padding-left: 0.222em;"></span><span class="mi" id="MathJax-Span-177" style="font-family: MathJax_Math; font-style: italic; padding-left: 0.222em;">i</span><span class="mo" id="MathJax-Span-178" style="font-family: MathJax_Main;">]</span></span><span style="display: inline-block; width: 0px; height: 2.292em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -1.506em; border-left: 0px solid; width: 0px; height: 3.634em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>d</mi><mo stretchy="false">[</mo><mi>n</mi><mo stretchy="false">]</mo><mo>=</mo><munderover><mo></mo><mrow class="MJX-TeXAtom-ORD"><mi>i</mi><mo>=</mo><mn>0</mn></mrow><mrow class="MJX-TeXAtom-ORD"><mi>n</mi><mo></mo><mn>1</mn></mrow></munderover><mi>d</mi><mo stretchy="false">[</mo><mi>i</mi><mo stretchy="false">]</mo><mo></mo><mi>d</mi><mo stretchy="false">[</mo><mi>n</mi><mo></mo><mn>1</mn><mo></mo><mi>i</mi><mo stretchy="false">]</mo></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-28">d[n] = \sum_{i=0}^{n-1} d[i] \cdot d[n-1-i]</script>
The initial value for this recurrence is <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-29-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;d&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;[&lt;/mo&gt;&lt;mn&gt;0&lt;/mn&gt;&lt;mo stretchy=&quot;false&quot;&gt;]&lt;/mo&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-179" style="width: 4.169em; display: inline-block;"><span style="display: inline-block; position: relative; width: 3.438em; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(1.385em, 1003.37em, 2.698em, -1000em); top: -2.292em; left: 0em;"><span class="mrow" id="MathJax-Span-180"><span class="mi" id="MathJax-Span-181" style="font-family: MathJax_Math; font-style: italic;">d<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-182" style="font-family: MathJax_Main;">[</span><span class="mn" id="MathJax-Span-183" style="font-family: MathJax_Main;">0</span><span class="mo" id="MathJax-Span-184" style="font-family: MathJax_Main;">]</span><span class="mo" id="MathJax-Span-185" style="font-family: MathJax_Main; padding-left: 0.278em;">=</span><span class="mn" id="MathJax-Span-186" style="font-family: MathJax_Main; padding-left: 0.278em;">1</span></span><span style="display: inline-block; width: 0px; height: 2.292em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.362em; border-left: 0px solid; width: 0px; height: 1.325em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>d</mi><mo stretchy="false">[</mo><mn>0</mn><mo stretchy="false">]</mo><mo>=</mo><mn>1</mn></math></span></span><script type="math/tex" id="MathJax-Element-29">d[0] = 1</script>.</p>

<h2 id="toc-tgt-4">Finding the lexicographical next balanced sequence</h2>

<p>Here we only consider the case with one valid bracket type.</p>

<p>Given a balanced sequence, we have to find the next (in lexicographical order) balanced sequence.</p>

<p>It should be obvious, that we have to find the rightmost opening 
bracket, which we can replace by a closing bracket without violation the
 condition, that there are more closing brackets than opening brackets 
up to this position.
After replacing this position, we can fill the remaining part of the 
string with the lexicographically minimal one: i.e. first with as much 
opening brackets as possible, and then fill up the remaining positions 
with closing brackets.
In other words we try to leave a long as possible prefix unchanged, and 
the suffix gets replaced by the lexicographically minimal one.</p>

<p>To find this position, we can iterate over the character from right to left, and maintain the balance <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-30-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mtext&gt;depth&lt;/mtext&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-187" style="width: 3.023em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.5em; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(1.337em, 1002.49em, 2.538em, -1000em); top: -2.188em; left: 0em;"><span class="mrow" id="MathJax-Span-188"><span class="mtext" id="MathJax-Span-189" style="font-family: MathJax_Main;">depth</span></span><span style="display: inline-block; width: 0px; height: 2.188em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.295em; border-left: 0px solid; width: 0px; height: 1.191em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mtext>depth</mtext></math></span></span><script type="math/tex" id="MathJax-Element-30">\text{depth}</script> of open and closing brackets.
When we meet an opening brackets, we will decrement <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-31-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mtext&gt;depth&lt;/mtext&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-190" style="width: 3.023em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.5em; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(1.337em, 1002.49em, 2.538em, -1000em); top: -2.188em; left: 0em;"><span class="mrow" id="MathJax-Span-191"><span class="mtext" id="MathJax-Span-192" style="font-family: MathJax_Main;">depth</span></span><span style="display: inline-block; width: 0px; height: 2.188em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.295em; border-left: 0px solid; width: 0px; height: 1.191em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mtext>depth</mtext></math></span></span><script type="math/tex" id="MathJax-Element-31">\text{depth}</script>,
 and when we meet a closing bracket, we increase it.
If we are at some point meet an opening bracket, and the balance after 
processing this symbol is positive, then we have found the rightmost 
position that we can change.
We change the symbol, compute the number of opening and closing brackets
 that we have to add to the right side, and arrange them in the 
lexicographically minimal way.</p>

<p>If we find do suitable position, then this sequence is already the maximal possible one, and there is no answer.</p>

<pre><code class="cpp hljs"><span class="hljs-keyword">bool</span> next_balanced_sequence(<span class="hljs-built_in">string</span> &amp; s) {
    <span class="hljs-keyword">int</span> n = s.size();
    <span class="hljs-keyword">int</span> depth = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = n - <span class="hljs-number">1</span>; i &gt;= <span class="hljs-number">0</span>; i--) {
        <span class="hljs-keyword">if</span> (s[i] == <span class="hljs-string">'('</span>)
            depth--;
        <span class="hljs-keyword">else</span>
            depth++;

        <span class="hljs-keyword">if</span> (s[i] == <span class="hljs-string">'('</span> &amp;&amp; depth &gt; <span class="hljs-number">0</span>) {
            depth--;
            <span class="hljs-keyword">int</span> open = (n - i - <span class="hljs-number">1</span> - depth) / <span class="hljs-number">2</span>;
            <span class="hljs-keyword">int</span> close = n - i - <span class="hljs-number">1</span> - open;
            <span class="hljs-built_in">string</span> next = s.substr(<span class="hljs-number">0</span>, i) + <span class="hljs-string">')'</span> + <span class="hljs-built_in">string</span>(open, <span class="hljs-string">'('</span>) + <span class="hljs-built_in">string</span>(close, <span class="hljs-string">')'</span>);
            s.swap(next);
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;
        }
    }
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;
}
</code></pre>

<p>This function computes in <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-32-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;O&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-193" style="width: 2.607em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.135em; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(1.385em, 1002.04em, 2.698em, -1000em); top: -2.292em; left: 0em;"><span class="mrow" id="MathJax-Span-194"><span class="mi" id="MathJax-Span-195" style="font-family: MathJax_Math; font-style: italic;">O</span><span class="mo" id="MathJax-Span-196" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-197" style="font-family: MathJax_Math; font-style: italic;">n</span><span class="mo" id="MathJax-Span-198" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.292em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.362em; border-left: 0px solid; width: 0px; height: 1.325em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>O</mi><mo stretchy="false">(</mo><mi>n</mi><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-32">O(n)</script> time the next balanced bracket sequence, and returns false if there is no next one.</p>

<h2 id="toc-tgt-5">Finding all balanced sequences</h2>

<p>Sometimes it is required to find and output all balanced bracket sequences of a specific length <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-33-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-199" style="width: 0.784em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.625em; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(1.693em, 1000.61em, 2.459em, -1000em); top: -2.292em; left: 0em;"><span class="mrow" id="MathJax-Span-200"><span class="mi" id="MathJax-Span-201" style="font-family: MathJax_Math; font-style: italic;">n</span></span><span style="display: inline-block; width: 0px; height: 2.292em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.076em; border-left: 0px solid; width: 0px; height: 0.669em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>n</mi></math></span></span><script type="math/tex" id="MathJax-Element-33">n</script>.</p>

<p>To generate then, we can start with the lexicographically smallest sequence <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-34-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mo&gt;&amp;#x2026;&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo&gt;&amp;#x2026;&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-202" style="width: 6.982em; display: inline-block;"><span style="display: inline-block; position: relative; width: 5.781em; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(1.281em, 1005.69em, 2.594em, -1000em); top: -2.188em; left: 0em;"><span class="mrow" id="MathJax-Span-203"><span class="mo" id="MathJax-Span-204" style="font-family: MathJax_Main;">(</span><span class="mo" id="MathJax-Span-205" style="font-family: MathJax_Main;">(</span><span class="mo" id="MathJax-Span-206" style="font-family: MathJax_Main;"></span><span class="mo" id="MathJax-Span-207" style="font-family: MathJax_Main; padding-left: 0.167em;">(</span><span class="mo" id="MathJax-Span-208" style="font-family: MathJax_Main;">(</span><span class="mo" id="MathJax-Span-209" style="font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-210" style="font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-211" style="font-family: MathJax_Main; padding-left: 0.167em;"></span><span class="mo" id="MathJax-Span-212" style="font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-213" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.188em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.362em; border-left: 0px solid; width: 0px; height: 1.325em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo stretchy="false">(</mo><mo stretchy="false">(</mo><mo></mo><mo stretchy="false">(</mo><mo stretchy="false">(</mo><mo stretchy="false">)</mo><mo stretchy="false">)</mo><mo></mo><mo stretchy="false">)</mo><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-34">((\dots(())\dots))</script>, and then continue to find the next lexicographically sequences with the algorithm described in the previous section.</p>

<p>However, if the length of the sequence is not very long (e.g. <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-35-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-214" style="width: 0.784em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.625em; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(1.693em, 1000.61em, 2.459em, -1000em); top: -2.292em; left: 0em;"><span class="mrow" id="MathJax-Span-215"><span class="mi" id="MathJax-Span-216" style="font-family: MathJax_Math; font-style: italic;">n</span></span><span style="display: inline-block; width: 0px; height: 2.292em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.076em; border-left: 0px solid; width: 0px; height: 0.669em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>n</mi></math></span></span><script type="math/tex" id="MathJax-Element-35">n</script> smaller than <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-36-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mn&gt;12&lt;/mn&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-217" style="width: 1.201em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.99em; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(1.365em, 1000.94em, 2.344em, -1000em); top: -2.188em; left: 0em;"><span class="mrow" id="MathJax-Span-218"><span class="mn" id="MathJax-Span-219" style="font-family: MathJax_Main;">12</span></span><span style="display: inline-block; width: 0px; height: 2.188em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.063em; border-left: 0px solid; width: 0px; height: 0.924em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn>12</mn></math></span></span><script type="math/tex" id="MathJax-Element-36">12</script>), then we can also generate all permutations conveniently with the C++ STL function <code>next_permutation</code>, and check each one for balanceness.</p>

<p>Also they can be generate using the ideas we used for counting all sequences with dynamic programming.
We will discuss the ideas in the next two sections.</p>

<h2 id="toc-tgt-6">Sequence index</h2>

<p>Given a balanced bracket sequence with <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-37-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-220" style="width: 0.784em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.625em; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(1.693em, 1000.61em, 2.459em, -1000em); top: -2.292em; left: 0em;"><span class="mrow" id="MathJax-Span-221"><span class="mi" id="MathJax-Span-222" style="font-family: MathJax_Math; font-style: italic;">n</span></span><span style="display: inline-block; width: 0px; height: 2.292em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.076em; border-left: 0px solid; width: 0px; height: 0.669em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>n</mi></math></span></span><script type="math/tex" id="MathJax-Element-37">n</script> pairs of brackets.
We have to find its index in the lexicographically ordered list of all balanced sequences with <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-38-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-223" style="width: 0.784em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.625em; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(1.693em, 1000.61em, 2.459em, -1000em); top: -2.292em; left: 0em;"><span class="mrow" id="MathJax-Span-224"><span class="mi" id="MathJax-Span-225" style="font-family: MathJax_Math; font-style: italic;">n</span></span><span style="display: inline-block; width: 0px; height: 2.292em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.076em; border-left: 0px solid; width: 0px; height: 0.669em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>n</mi></math></span></span><script type="math/tex" id="MathJax-Element-38">n</script> bracket pairs.</p>

<p>Let's define an auxiliary array <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-39-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;d&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;[&lt;/mo&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;]&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;[&lt;/mo&gt;&lt;mi&gt;j&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;]&lt;/mo&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-226" style="width: 2.919em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.396em; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(1.385em, 1002.28em, 2.698em, -1000em); top: -2.292em; left: 0em;"><span class="mrow" id="MathJax-Span-227"><span class="mi" id="MathJax-Span-228" style="font-family: MathJax_Math; font-style: italic;">d<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-229" style="font-family: MathJax_Main;">[</span><span class="mi" id="MathJax-Span-230" style="font-family: MathJax_Math; font-style: italic;">i</span><span class="mo" id="MathJax-Span-231" style="font-family: MathJax_Main;">]</span><span class="mo" id="MathJax-Span-232" style="font-family: MathJax_Main;">[</span><span class="mi" id="MathJax-Span-233" style="font-family: MathJax_Math; font-style: italic;">j</span><span class="mo" id="MathJax-Span-234" style="font-family: MathJax_Main;">]</span></span><span style="display: inline-block; width: 0px; height: 2.292em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.362em; border-left: 0px solid; width: 0px; height: 1.325em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>d</mi><mo stretchy="false">[</mo><mi>i</mi><mo stretchy="false">]</mo><mo stretchy="false">[</mo><mi>j</mi><mo stretchy="false">]</mo></math></span></span><script type="math/tex" id="MathJax-Element-39">d[i][j]</script>, where <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-40-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-235" style="width: 0.471em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.365em; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(1.474em, 1000.32em, 2.459em, -1000em); top: -2.292em; left: 0em;"><span class="mrow" id="MathJax-Span-236"><span class="mi" id="MathJax-Span-237" style="font-family: MathJax_Math; font-style: italic;">i</span></span><span style="display: inline-block; width: 0px; height: 2.292em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.076em; border-left: 0px solid; width: 0px; height: 0.931em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>i</mi></math></span></span><script type="math/tex" id="MathJax-Element-40">i</script>
 is the length of the bracket sequence (semi-balanced, each closing 
bracket has a corresponding opening bracket, but not every opening 
bracket has necessarily a corresponding closing one), and <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-41-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;j&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-238" style="width: 0.523em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.417em; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(1.474em, 1000.41em, 2.652em, -1000em); top: -2.292em; left: 0em;"><span class="mrow" id="MathJax-Span-239"><span class="mi" id="MathJax-Span-240" style="font-family: MathJax_Math; font-style: italic;">j</span></span><span style="display: inline-block; width: 0px; height: 2.292em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.307em; border-left: 0px solid; width: 0px; height: 1.163em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>j</mi></math></span></span><script type="math/tex" id="MathJax-Element-41">j</script> is the current balance (difference between opening and closing brackets).
<span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-42-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;d&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;[&lt;/mo&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;]&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;[&lt;/mo&gt;&lt;mi&gt;j&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;]&lt;/mo&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-241" style="width: 2.919em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.396em; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(1.385em, 1002.28em, 2.698em, -1000em); top: -2.292em; left: 0em;"><span class="mrow" id="MathJax-Span-242"><span class="mi" id="MathJax-Span-243" style="font-family: MathJax_Math; font-style: italic;">d<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-244" style="font-family: MathJax_Main;">[</span><span class="mi" id="MathJax-Span-245" style="font-family: MathJax_Math; font-style: italic;">i</span><span class="mo" id="MathJax-Span-246" style="font-family: MathJax_Main;">]</span><span class="mo" id="MathJax-Span-247" style="font-family: MathJax_Main;">[</span><span class="mi" id="MathJax-Span-248" style="font-family: MathJax_Math; font-style: italic;">j</span><span class="mo" id="MathJax-Span-249" style="font-family: MathJax_Main;">]</span></span><span style="display: inline-block; width: 0px; height: 2.292em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.362em; border-left: 0px solid; width: 0px; height: 1.325em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>d</mi><mo stretchy="false">[</mo><mi>i</mi><mo stretchy="false">]</mo><mo stretchy="false">[</mo><mi>j</mi><mo stretchy="false">]</mo></math></span></span><script type="math/tex" id="MathJax-Element-42">d[i][j]</script> is the number of such sequences that fit the parameters.
We will calculate these numbers with only one bracket type.</p>

<p>For the start value <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-43-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mn&gt;0&lt;/mn&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-250" style="width: 2.659em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.188em; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(1.469em, 1002.15em, 2.47em, -1000em); top: -2.292em; left: 0em;"><span class="mrow" id="MathJax-Span-251"><span class="mi" id="MathJax-Span-252" style="font-family: MathJax_Math; font-style: italic;">i</span><span class="mo" id="MathJax-Span-253" style="font-family: MathJax_Main; padding-left: 0.278em;">=</span><span class="mn" id="MathJax-Span-254" style="font-family: MathJax_Main; padding-left: 0.278em;">0</span></span><span style="display: inline-block; width: 0px; height: 2.292em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.089em; border-left: 0px solid; width: 0px; height: 0.951em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>i</mi><mo>=</mo><mn>0</mn></math></span></span><script type="math/tex" id="MathJax-Element-43">i = 0</script> the answer is obvious: <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-44-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;d&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;[&lt;/mo&gt;&lt;mn&gt;0&lt;/mn&gt;&lt;mo stretchy=&quot;false&quot;&gt;]&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;[&lt;/mo&gt;&lt;mn&gt;0&lt;/mn&gt;&lt;mo stretchy=&quot;false&quot;&gt;]&lt;/mo&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-255" style="width: 5.419em; display: inline-block;"><span style="display: inline-block; position: relative; width: 4.479em; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(1.385em, 1004.41em, 2.698em, -1000em); top: -2.292em; left: 0em;"><span class="mrow" id="MathJax-Span-256"><span class="mi" id="MathJax-Span-257" style="font-family: MathJax_Math; font-style: italic;">d<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-258" style="font-family: MathJax_Main;">[</span><span class="mn" id="MathJax-Span-259" style="font-family: MathJax_Main;">0</span><span class="mo" id="MathJax-Span-260" style="font-family: MathJax_Main;">]</span><span class="mo" id="MathJax-Span-261" style="font-family: MathJax_Main;">[</span><span class="mn" id="MathJax-Span-262" style="font-family: MathJax_Main;">0</span><span class="mo" id="MathJax-Span-263" style="font-family: MathJax_Main;">]</span><span class="mo" id="MathJax-Span-264" style="font-family: MathJax_Main; padding-left: 0.278em;">=</span><span class="mn" id="MathJax-Span-265" style="font-family: MathJax_Main; padding-left: 0.278em;">1</span></span><span style="display: inline-block; width: 0px; height: 2.292em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.362em; border-left: 0px solid; width: 0px; height: 1.325em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>d</mi><mo stretchy="false">[</mo><mn>0</mn><mo stretchy="false">]</mo><mo stretchy="false">[</mo><mn>0</mn><mo stretchy="false">]</mo><mo>=</mo><mn>1</mn></math></span></span><script type="math/tex" id="MathJax-Element-44">d[0][0] = 1</script>, and <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-45-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;d&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;[&lt;/mo&gt;&lt;mn&gt;0&lt;/mn&gt;&lt;mo stretchy=&quot;false&quot;&gt;]&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;[&lt;/mo&gt;&lt;mi&gt;j&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;]&lt;/mo&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mn&gt;0&lt;/mn&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-266" style="width: 5.263em; display: inline-block;"><span style="display: inline-block; position: relative; width: 4.375em; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(1.385em, 1004.34em, 2.698em, -1000em); top: -2.292em; left: 0em;"><span class="mrow" id="MathJax-Span-267"><span class="mi" id="MathJax-Span-268" style="font-family: MathJax_Math; font-style: italic;">d<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-269" style="font-family: MathJax_Main;">[</span><span class="mn" id="MathJax-Span-270" style="font-family: MathJax_Main;">0</span><span class="mo" id="MathJax-Span-271" style="font-family: MathJax_Main;">]</span><span class="mo" id="MathJax-Span-272" style="font-family: MathJax_Main;">[</span><span class="mi" id="MathJax-Span-273" style="font-family: MathJax_Math; font-style: italic;">j</span><span class="mo" id="MathJax-Span-274" style="font-family: MathJax_Main;">]</span><span class="mo" id="MathJax-Span-275" style="font-family: MathJax_Main; padding-left: 0.278em;">=</span><span class="mn" id="MathJax-Span-276" style="font-family: MathJax_Main; padding-left: 0.278em;">0</span></span><span style="display: inline-block; width: 0px; height: 2.292em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.362em; border-left: 0px solid; width: 0px; height: 1.325em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>d</mi><mo stretchy="false">[</mo><mn>0</mn><mo stretchy="false">]</mo><mo stretchy="false">[</mo><mi>j</mi><mo stretchy="false">]</mo><mo>=</mo><mn>0</mn></math></span></span><script type="math/tex" id="MathJax-Element-45">d[0][j] = 0</script> for <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-46-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;j&lt;/mi&gt;&lt;mo&gt;&amp;gt;&lt;/mo&gt;&lt;mn&gt;0&lt;/mn&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-277" style="width: 2.711em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.24em; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(1.469em, 1002.2em, 2.652em, -1000em); top: -2.292em; left: 0em;"><span class="mrow" id="MathJax-Span-278"><span class="mi" id="MathJax-Span-279" style="font-family: MathJax_Math; font-style: italic;">j</span><span class="mo" id="MathJax-Span-280" style="font-family: MathJax_Main; padding-left: 0.278em;">&gt;</span><span class="mn" id="MathJax-Span-281" style="font-family: MathJax_Main; padding-left: 0.278em;">0</span></span><span style="display: inline-block; width: 0px; height: 2.292em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.307em; border-left: 0px solid; width: 0px; height: 1.169em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>j</mi><mo>&gt;</mo><mn>0</mn></math></span></span><script type="math/tex" id="MathJax-Element-46">j > 0</script>.
Now let <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-47-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;mo&gt;&amp;gt;&lt;/mo&gt;&lt;mn&gt;0&lt;/mn&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-282" style="width: 2.659em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.188em; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(1.469em, 1002.15em, 2.488em, -1000em); top: -2.292em; left: 0em;"><span class="mrow" id="MathJax-Span-283"><span class="mi" id="MathJax-Span-284" style="font-family: MathJax_Math; font-style: italic;">i</span><span class="mo" id="MathJax-Span-285" style="font-family: MathJax_Main; padding-left: 0.278em;">&gt;</span><span class="mn" id="MathJax-Span-286" style="font-family: MathJax_Main; padding-left: 0.278em;">0</span></span><span style="display: inline-block; width: 0px; height: 2.292em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.111em; border-left: 0px solid; width: 0px; height: 0.972em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>i</mi><mo>&gt;</mo><mn>0</mn></math></span></span><script type="math/tex" id="MathJax-Element-47">i > 0</script>, and we look at the last character in the sequence.
If the last character was an opening bracket <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-48-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-287" style="width: 0.471em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.365em; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(1.281em, 1000.31em, 2.594em, -1000em); top: -2.188em; left: 0em;"><span class="mrow" id="MathJax-Span-288"><span class="mo" id="MathJax-Span-289" style="font-family: MathJax_Main;">(</span></span><span style="display: inline-block; width: 0px; height: 2.188em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.362em; border-left: 0px solid; width: 0px; height: 1.325em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo stretchy="false">(</mo></math></span></span><script type="math/tex" id="MathJax-Element-48">(</script>, then the state before was <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-49-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mi&gt;j&lt;/mi&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-290" style="width: 6.513em; display: inline-block;"><span style="display: inline-block; position: relative; width: 5.417em; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(1.385em, 1005.32em, 2.698em, -1000em); top: -2.292em; left: 0em;"><span class="mrow" id="MathJax-Span-291"><span class="mo" id="MathJax-Span-292" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-293" style="font-family: MathJax_Math; font-style: italic;">i</span><span class="mo" id="MathJax-Span-294" style="font-family: MathJax_Main; padding-left: 0.222em;"></span><span class="mn" id="MathJax-Span-295" style="font-family: MathJax_Main; padding-left: 0.222em;">1</span><span class="mo" id="MathJax-Span-296" style="font-family: MathJax_Main;">,</span><span class="mi" id="MathJax-Span-297" style="font-family: MathJax_Math; font-style: italic; padding-left: 0.167em;">j</span><span class="mo" id="MathJax-Span-298" style="font-family: MathJax_Main; padding-left: 0.222em;"></span><span class="mn" id="MathJax-Span-299" style="font-family: MathJax_Main; padding-left: 0.222em;">1</span><span class="mo" id="MathJax-Span-300" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.292em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.362em; border-left: 0px solid; width: 0px; height: 1.325em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo stretchy="false">(</mo><mi>i</mi><mo></mo><mn>1</mn><mo>,</mo><mi>j</mi><mo></mo><mn>1</mn><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-49">(i-1, j-1)</script>, if it was a closing bracket <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-50-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-301" style="width: 0.471em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.365em; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(1.281em, 1000.27em, 2.594em, -1000em); top: -2.188em; left: 0em;"><span class="mrow" id="MathJax-Span-302"><span class="mo" id="MathJax-Span-303" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.188em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.362em; border-left: 0px solid; width: 0px; height: 1.325em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-50">)</script>, then the previous state was <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-51-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mi&gt;j&lt;/mi&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-304" style="width: 6.513em; display: inline-block;"><span style="display: inline-block; position: relative; width: 5.417em; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(1.385em, 1005.32em, 2.698em, -1000em); top: -2.292em; left: 0em;"><span class="mrow" id="MathJax-Span-305"><span class="mo" id="MathJax-Span-306" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-307" style="font-family: MathJax_Math; font-style: italic;">i</span><span class="mo" id="MathJax-Span-308" style="font-family: MathJax_Main; padding-left: 0.222em;"></span><span class="mn" id="MathJax-Span-309" style="font-family: MathJax_Main; padding-left: 0.222em;">1</span><span class="mo" id="MathJax-Span-310" style="font-family: MathJax_Main;">,</span><span class="mi" id="MathJax-Span-311" style="font-family: MathJax_Math; font-style: italic; padding-left: 0.167em;">j</span><span class="mo" id="MathJax-Span-312" style="font-family: MathJax_Main; padding-left: 0.222em;">+</span><span class="mn" id="MathJax-Span-313" style="font-family: MathJax_Main; padding-left: 0.222em;">1</span><span class="mo" id="MathJax-Span-314" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.292em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.362em; border-left: 0px solid; width: 0px; height: 1.325em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo stretchy="false">(</mo><mi>i</mi><mo></mo><mn>1</mn><mo>,</mo><mi>j</mi><mo>+</mo><mn>1</mn><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-51">(i-1, j+1)</script>.
Thus we obtain the recursion formula:
<span class="MathJax_Preview" style="color: inherit; display: none;"></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-52-Frame" tabindex="0" style="text-align: center; position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;mi&gt;d&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;[&lt;/mo&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;]&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;[&lt;/mo&gt;&lt;mi&gt;j&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;]&lt;/mo&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mi&gt;d&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;[&lt;/mo&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mo stretchy=&quot;false&quot;&gt;]&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;[&lt;/mo&gt;&lt;mi&gt;j&lt;/mi&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mo stretchy=&quot;false&quot;&gt;]&lt;/mo&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mi&gt;d&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;[&lt;/mo&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mo stretchy=&quot;false&quot;&gt;]&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;[&lt;/mo&gt;&lt;mi&gt;j&lt;/mi&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mo stretchy=&quot;false&quot;&gt;]&lt;/mo&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-315" style="width: 19.951em; display: inline-block;"><span style="display: inline-block; position: relative; width: 16.615em; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(1.385em, 1016.5em, 2.698em, -1000em); top: -2.292em; left: 0em;"><span class="mrow" id="MathJax-Span-316"><span class="mi" id="MathJax-Span-317" style="font-family: MathJax_Math; font-style: italic;">d<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-318" style="font-family: MathJax_Main;">[</span><span class="mi" id="MathJax-Span-319" style="font-family: MathJax_Math; font-style: italic;">i</span><span class="mo" id="MathJax-Span-320" style="font-family: MathJax_Main;">]</span><span class="mo" id="MathJax-Span-321" style="font-family: MathJax_Main;">[</span><span class="mi" id="MathJax-Span-322" style="font-family: MathJax_Math; font-style: italic;">j</span><span class="mo" id="MathJax-Span-323" style="font-family: MathJax_Main;">]</span><span class="mo" id="MathJax-Span-324" style="font-family: MathJax_Main; padding-left: 0.278em;">=</span><span class="mi" id="MathJax-Span-325" style="font-family: MathJax_Math; font-style: italic; padding-left: 0.278em;">d<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-326" style="font-family: MathJax_Main;">[</span><span class="mi" id="MathJax-Span-327" style="font-family: MathJax_Math; font-style: italic;">i</span><span class="mo" id="MathJax-Span-328" style="font-family: MathJax_Main; padding-left: 0.222em;"></span><span class="mn" id="MathJax-Span-329" style="font-family: MathJax_Main; padding-left: 0.222em;">1</span><span class="mo" id="MathJax-Span-330" style="font-family: MathJax_Main;">]</span><span class="mo" id="MathJax-Span-331" style="font-family: MathJax_Main;">[</span><span class="mi" id="MathJax-Span-332" style="font-family: MathJax_Math; font-style: italic;">j</span><span class="mo" id="MathJax-Span-333" style="font-family: MathJax_Main; padding-left: 0.222em;"></span><span class="mn" id="MathJax-Span-334" style="font-family: MathJax_Main; padding-left: 0.222em;">1</span><span class="mo" id="MathJax-Span-335" style="font-family: MathJax_Main;">]</span><span class="mo" id="MathJax-Span-336" style="font-family: MathJax_Main; padding-left: 0.222em;">+</span><span class="mi" id="MathJax-Span-337" style="font-family: MathJax_Math; font-style: italic; padding-left: 0.222em;">d<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-338" style="font-family: MathJax_Main;">[</span><span class="mi" id="MathJax-Span-339" style="font-family: MathJax_Math; font-style: italic;">i</span><span class="mo" id="MathJax-Span-340" style="font-family: MathJax_Main; padding-left: 0.222em;"></span><span class="mn" id="MathJax-Span-341" style="font-family: MathJax_Main; padding-left: 0.222em;">1</span><span class="mo" id="MathJax-Span-342" style="font-family: MathJax_Main;">]</span><span class="mo" id="MathJax-Span-343" style="font-family: MathJax_Main;">[</span><span class="mi" id="MathJax-Span-344" style="font-family: MathJax_Math; font-style: italic;">j</span><span class="mo" id="MathJax-Span-345" style="font-family: MathJax_Main; padding-left: 0.222em;">+</span><span class="mn" id="MathJax-Span-346" style="font-family: MathJax_Main; padding-left: 0.222em;">1</span><span class="mo" id="MathJax-Span-347" style="font-family: MathJax_Main;">]</span></span><span style="display: inline-block; width: 0px; height: 2.292em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.362em; border-left: 0px solid; width: 0px; height: 1.325em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>d</mi><mo stretchy="false">[</mo><mi>i</mi><mo stretchy="false">]</mo><mo stretchy="false">[</mo><mi>j</mi><mo stretchy="false">]</mo><mo>=</mo><mi>d</mi><mo stretchy="false">[</mo><mi>i</mi><mo></mo><mn>1</mn><mo stretchy="false">]</mo><mo stretchy="false">[</mo><mi>j</mi><mo></mo><mn>1</mn><mo stretchy="false">]</mo><mo>+</mo><mi>d</mi><mo stretchy="false">[</mo><mi>i</mi><mo></mo><mn>1</mn><mo stretchy="false">]</mo><mo stretchy="false">[</mo><mi>j</mi><mo>+</mo><mn>1</mn><mo stretchy="false">]</mo></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-52">d[i][j] = d[i-1][j-1] + d[i-1][j+1]</script>
<span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-53-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;d&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;[&lt;/mo&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;]&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;[&lt;/mo&gt;&lt;mi&gt;j&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;]&lt;/mo&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mn&gt;0&lt;/mn&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-348" style="width: 5.107em; display: inline-block;"><span style="display: inline-block; position: relative; width: 4.219em; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(1.385em, 1004.18em, 2.698em, -1000em); top: -2.292em; left: 0em;"><span class="mrow" id="MathJax-Span-349"><span class="mi" id="MathJax-Span-350" style="font-family: MathJax_Math; font-style: italic;">d<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-351" style="font-family: MathJax_Main;">[</span><span class="mi" id="MathJax-Span-352" style="font-family: MathJax_Math; font-style: italic;">i</span><span class="mo" id="MathJax-Span-353" style="font-family: MathJax_Main;">]</span><span class="mo" id="MathJax-Span-354" style="font-family: MathJax_Main;">[</span><span class="mi" id="MathJax-Span-355" style="font-family: MathJax_Math; font-style: italic;">j</span><span class="mo" id="MathJax-Span-356" style="font-family: MathJax_Main;">]</span><span class="mo" id="MathJax-Span-357" style="font-family: MathJax_Main; padding-left: 0.278em;">=</span><span class="mn" id="MathJax-Span-358" style="font-family: MathJax_Main; padding-left: 0.278em;">0</span></span><span style="display: inline-block; width: 0px; height: 2.292em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.362em; border-left: 0px solid; width: 0px; height: 1.325em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>d</mi><mo stretchy="false">[</mo><mi>i</mi><mo stretchy="false">]</mo><mo stretchy="false">[</mo><mi>j</mi><mo stretchy="false">]</mo><mo>=</mo><mn>0</mn></math></span></span><script type="math/tex" id="MathJax-Element-53">d[i][j] = 0</script> holds obviously for negative <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-54-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;j&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-359" style="width: 0.523em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.417em; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(1.474em, 1000.41em, 2.652em, -1000em); top: -2.292em; left: 0em;"><span class="mrow" id="MathJax-Span-360"><span class="mi" id="MathJax-Span-361" style="font-family: MathJax_Math; font-style: italic;">j</span></span><span style="display: inline-block; width: 0px; height: 2.292em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.307em; border-left: 0px solid; width: 0px; height: 1.163em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>j</mi></math></span></span><script type="math/tex" id="MathJax-Element-54">j</script>.
Thus we can compute this array in <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-55-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;O&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;msup&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msup&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-362" style="width: 3.076em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.552em; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(1.302em, 1002.46em, 2.698em, -1000em); top: -2.292em; left: 0em;"><span class="mrow" id="MathJax-Span-363"><span class="mi" id="MathJax-Span-364" style="font-family: MathJax_Math; font-style: italic;">O</span><span class="mo" id="MathJax-Span-365" style="font-family: MathJax_Main;">(</span><span class="msubsup" id="MathJax-Span-366"><span style="display: inline-block; position: relative; width: 1.029em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.58em, 4.178em, -1000em); top: -4.01em; left: 0em;"><span class="mi" id="MathJax-Span-367" style="font-family: MathJax_Math; font-style: italic;">n</span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span><span style="position: absolute; top: -4.373em; left: 0.6em;"><span class="mn" id="MathJax-Span-368" style="font-size: 70.7%; font-family: MathJax_Main;">2</span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span></span></span><span class="mo" id="MathJax-Span-369" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.292em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.362em; border-left: 0px solid; width: 0px; height: 1.426em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>O</mi><mo stretchy="false">(</mo><msup><mi>n</mi><mn>2</mn></msup><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-55">O(n^2)</script>.</p>

<p>Now let us generate the index for a given sequence.</p>

<p>First let there be only one type of brackets.
We will us the counter <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-56-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mtext&gt;depth&lt;/mtext&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-370" style="width: 3.023em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.5em; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(1.337em, 1002.49em, 2.538em, -1000em); top: -2.188em; left: 0em;"><span class="mrow" id="MathJax-Span-371"><span class="mtext" id="MathJax-Span-372" style="font-family: MathJax_Main;">depth</span></span><span style="display: inline-block; width: 0px; height: 2.188em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.295em; border-left: 0px solid; width: 0px; height: 1.191em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mtext>depth</mtext></math></span></span><script type="math/tex" id="MathJax-Element-56">\text{depth}</script> which tells us how nested we currently are, and iterate over the characters of the sequence.
If the current character <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-57-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;[&lt;/mo&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;]&lt;/mo&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-373" style="width: 1.669em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.354em; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(1.385em, 1001.24em, 2.698em, -1000em); top: -2.292em; left: 0em;"><span class="mrow" id="MathJax-Span-374"><span class="mi" id="MathJax-Span-375" style="font-family: MathJax_Math; font-style: italic;">s</span><span class="mo" id="MathJax-Span-376" style="font-family: MathJax_Main;">[</span><span class="mi" id="MathJax-Span-377" style="font-family: MathJax_Math; font-style: italic;">i</span><span class="mo" id="MathJax-Span-378" style="font-family: MathJax_Main;">]</span></span><span style="display: inline-block; width: 0px; height: 2.292em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.362em; border-left: 0px solid; width: 0px; height: 1.325em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>s</mi><mo stretchy="false">[</mo><mi>i</mi><mo stretchy="false">]</mo></math></span></span><script type="math/tex" id="MathJax-Element-57">s[i]</script> is equal to <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-58-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-379" style="width: 0.471em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.365em; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(1.281em, 1000.31em, 2.594em, -1000em); top: -2.188em; left: 0em;"><span class="mrow" id="MathJax-Span-380"><span class="mo" id="MathJax-Span-381" style="font-family: MathJax_Main;">(</span></span><span style="display: inline-block; width: 0px; height: 2.188em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.362em; border-left: 0px solid; width: 0px; height: 1.325em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo stretchy="false">(</mo></math></span></span><script type="math/tex" id="MathJax-Element-58">(</script>, then we increment <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-59-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mtext&gt;depth&lt;/mtext&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-382" style="width: 3.023em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.5em; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(1.337em, 1002.49em, 2.538em, -1000em); top: -2.188em; left: 0em;"><span class="mrow" id="MathJax-Span-383"><span class="mtext" id="MathJax-Span-384" style="font-family: MathJax_Main;">depth</span></span><span style="display: inline-block; width: 0px; height: 2.188em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.295em; border-left: 0px solid; width: 0px; height: 1.191em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mtext>depth</mtext></math></span></span><script type="math/tex" id="MathJax-Element-59">\text{depth}</script>.
If the current character <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-60-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;[&lt;/mo&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;]&lt;/mo&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-385" style="width: 1.669em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.354em; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(1.385em, 1001.24em, 2.698em, -1000em); top: -2.292em; left: 0em;"><span class="mrow" id="MathJax-Span-386"><span class="mi" id="MathJax-Span-387" style="font-family: MathJax_Math; font-style: italic;">s</span><span class="mo" id="MathJax-Span-388" style="font-family: MathJax_Main;">[</span><span class="mi" id="MathJax-Span-389" style="font-family: MathJax_Math; font-style: italic;">i</span><span class="mo" id="MathJax-Span-390" style="font-family: MathJax_Main;">]</span></span><span style="display: inline-block; width: 0px; height: 2.292em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.362em; border-left: 0px solid; width: 0px; height: 1.325em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>s</mi><mo stretchy="false">[</mo><mi>i</mi><mo stretchy="false">]</mo></math></span></span><script type="math/tex" id="MathJax-Element-60">s[i]</script> is equal to <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-61-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-391" style="width: 0.471em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.365em; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(1.281em, 1000.27em, 2.594em, -1000em); top: -2.188em; left: 0em;"><span class="mrow" id="MathJax-Span-392"><span class="mo" id="MathJax-Span-393" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.188em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.362em; border-left: 0px solid; width: 0px; height: 1.325em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-61">)</script>, then we must add <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-62-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;d&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;[&lt;/mo&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mo stretchy=&quot;false&quot;&gt;]&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;[&lt;/mo&gt;&lt;mtext&gt;depth&lt;/mtext&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mo stretchy=&quot;false&quot;&gt;]&lt;/mo&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-394" style="width: 12.346em; display: inline-block;"><span style="display: inline-block; position: relative; width: 10.26em; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(1.385em, 1010.14em, 2.698em, -1000em); top: -2.292em; left: 0em;"><span class="mrow" id="MathJax-Span-395"><span class="mi" id="MathJax-Span-396" style="font-family: MathJax_Math; font-style: italic;">d<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-397" style="font-family: MathJax_Main;">[</span><span class="mn" id="MathJax-Span-398" style="font-family: MathJax_Main;">2</span><span class="mi" id="MathJax-Span-399" style="font-family: MathJax_Math; font-style: italic;">n</span><span class="mo" id="MathJax-Span-400" style="font-family: MathJax_Main; padding-left: 0.222em;"></span><span class="mi" id="MathJax-Span-401" style="font-family: MathJax_Math; font-style: italic; padding-left: 0.222em;">i</span><span class="mo" id="MathJax-Span-402" style="font-family: MathJax_Main; padding-left: 0.222em;"></span><span class="mn" id="MathJax-Span-403" style="font-family: MathJax_Main; padding-left: 0.222em;">1</span><span class="mo" id="MathJax-Span-404" style="font-family: MathJax_Main;">]</span><span class="mo" id="MathJax-Span-405" style="font-family: MathJax_Main;">[</span><span class="mtext" id="MathJax-Span-406" style="font-family: MathJax_Main;">depth</span><span class="mo" id="MathJax-Span-407" style="font-family: MathJax_Main; padding-left: 0.222em;">+</span><span class="mn" id="MathJax-Span-408" style="font-family: MathJax_Main; padding-left: 0.222em;">1</span><span class="mo" id="MathJax-Span-409" style="font-family: MathJax_Main;">]</span></span><span style="display: inline-block; width: 0px; height: 2.292em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.362em; border-left: 0px solid; width: 0px; height: 1.325em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>d</mi><mo stretchy="false">[</mo><mn>2</mn><mi>n</mi><mo></mo><mi>i</mi><mo></mo><mn>1</mn><mo stretchy="false">]</mo><mo stretchy="false">[</mo><mtext>depth</mtext><mo>+</mo><mn>1</mn><mo stretchy="false">]</mo></math></span></span><script type="math/tex" id="MathJax-Element-62">d[2n-i-1][\text{depth}+1]</script> to the answer, taking all possible endings starting with a <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-63-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-410" style="width: 0.471em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.365em; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(1.281em, 1000.31em, 2.594em, -1000em); top: -2.188em; left: 0em;"><span class="mrow" id="MathJax-Span-411"><span class="mo" id="MathJax-Span-412" style="font-family: MathJax_Main;">(</span></span><span style="display: inline-block; width: 0px; height: 2.188em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.362em; border-left: 0px solid; width: 0px; height: 1.325em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo stretchy="false">(</mo></math></span></span><script type="math/tex" id="MathJax-Element-63">(</script> into account (which are lexicographically smaller sequences), and then decrement <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-64-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mtext&gt;depth&lt;/mtext&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-413" style="width: 3.023em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.5em; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(1.337em, 1002.49em, 2.538em, -1000em); top: -2.188em; left: 0em;"><span class="mrow" id="MathJax-Span-414"><span class="mtext" id="MathJax-Span-415" style="font-family: MathJax_Main;">depth</span></span><span style="display: inline-block; width: 0px; height: 2.188em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.295em; border-left: 0px solid; width: 0px; height: 1.191em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mtext>depth</mtext></math></span></span><script type="math/tex" id="MathJax-Element-64">\text{depth}</script>.</p>

<p>New let there be <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-65-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;k&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-416" style="width: 0.628em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.521em; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(1.441em, 1000.5em, 2.459em, -1000em); top: -2.292em; left: 0em;"><span class="mrow" id="MathJax-Span-417"><span class="mi" id="MathJax-Span-418" style="font-family: MathJax_Math; font-style: italic;">k</span></span><span style="display: inline-block; width: 0px; height: 2.292em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.076em; border-left: 0px solid; width: 0px; height: 0.971em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>k</mi></math></span></span><script type="math/tex" id="MathJax-Element-65">k</script> different bracket types.</p>

<p>Thus, when we look at the current character <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-66-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;[&lt;/mo&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;]&lt;/mo&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-419" style="width: 1.669em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.354em; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(1.385em, 1001.24em, 2.698em, -1000em); top: -2.292em; left: 0em;"><span class="mrow" id="MathJax-Span-420"><span class="mi" id="MathJax-Span-421" style="font-family: MathJax_Math; font-style: italic;">s</span><span class="mo" id="MathJax-Span-422" style="font-family: MathJax_Main;">[</span><span class="mi" id="MathJax-Span-423" style="font-family: MathJax_Math; font-style: italic;">i</span><span class="mo" id="MathJax-Span-424" style="font-family: MathJax_Main;">]</span></span><span style="display: inline-block; width: 0px; height: 2.292em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.362em; border-left: 0px solid; width: 0px; height: 1.325em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>s</mi><mo stretchy="false">[</mo><mi>i</mi><mo stretchy="false">]</mo></math></span></span><script type="math/tex" id="MathJax-Element-66">s[i]</script> before recomputing <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-67-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mtext&gt;depth&lt;/mtext&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-425" style="width: 3.023em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.5em; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(1.337em, 1002.49em, 2.538em, -1000em); top: -2.188em; left: 0em;"><span class="mrow" id="MathJax-Span-426"><span class="mtext" id="MathJax-Span-427" style="font-family: MathJax_Main;">depth</span></span><span style="display: inline-block; width: 0px; height: 2.188em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.295em; border-left: 0px solid; width: 0px; height: 1.191em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mtext>depth</mtext></math></span></span><script type="math/tex" id="MathJax-Element-67">\text{depth}</script>,
 we have to go through all bracket types that are smaller than the 
current character, and try to put this bracket into the current position
 (obtaining a new balance <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-68-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mtext&gt;ndepth&lt;/mtext&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mtext&gt;depth&lt;/mtext&gt;&lt;mo&gt;&amp;#x00B1;&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-428" style="width: 10.315em; display: inline-block;"><span style="display: inline-block; position: relative; width: 8.594em; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(1.337em, 1008.52em, 2.538em, -1000em); top: -2.188em; left: 0em;"><span class="mrow" id="MathJax-Span-429"><span class="mtext" id="MathJax-Span-430" style="font-family: MathJax_Main;">ndepth</span><span class="mo" id="MathJax-Span-431" style="font-family: MathJax_Main; padding-left: 0.278em;">=</span><span class="mtext" id="MathJax-Span-432" style="font-family: MathJax_Main; padding-left: 0.278em;">depth</span><span class="mo" id="MathJax-Span-433" style="font-family: MathJax_Main; padding-left: 0.222em;"></span><span class="mn" id="MathJax-Span-434" style="font-family: MathJax_Main; padding-left: 0.222em;">1</span></span><span style="display: inline-block; width: 0px; height: 2.188em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.295em; border-left: 0px solid; width: 0px; height: 1.191em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mtext>ndepth</mtext><mo>=</mo><mtext>depth</mtext><mo></mo><mn>1</mn></math></span></span><script type="math/tex" id="MathJax-Element-68">\text{ndepth} = \text{depth} \pm 1</script>), and add the number of ways to finish the sequence (length <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-69-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-435" style="width: 5.263em; display: inline-block;"><span style="display: inline-block; position: relative; width: 4.375em; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(1.469em, 1004.3em, 2.53em, -1000em); top: -2.292em; left: 0em;"><span class="mrow" id="MathJax-Span-436"><span class="mn" id="MathJax-Span-437" style="font-family: MathJax_Main;">2</span><span class="mi" id="MathJax-Span-438" style="font-family: MathJax_Math; font-style: italic;">n</span><span class="mo" id="MathJax-Span-439" style="font-family: MathJax_Main; padding-left: 0.222em;"></span><span class="mi" id="MathJax-Span-440" style="font-family: MathJax_Math; font-style: italic; padding-left: 0.222em;">i</span><span class="mo" id="MathJax-Span-441" style="font-family: MathJax_Main; padding-left: 0.222em;"></span><span class="mn" id="MathJax-Span-442" style="font-family: MathJax_Main; padding-left: 0.222em;">1</span></span><span style="display: inline-block; width: 0px; height: 2.292em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.161em; border-left: 0px solid; width: 0px; height: 1.023em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn>2</mn><mi>n</mi><mo></mo><mi>i</mi><mo></mo><mn>1</mn></math></span></span><script type="math/tex" id="MathJax-Element-69">2n-i-1</script>, balance <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-70-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;mi&gt;d&lt;/mi&gt;&lt;mi&gt;e&lt;/mi&gt;&lt;mi&gt;p&lt;/mi&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mi&gt;h&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-443" style="width: 3.648em; display: inline-block;"><span style="display: inline-block; position: relative; width: 3.021em; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(1.441em, 1003em, 2.642em, -1000em); top: -2.292em; left: 0em;"><span class="mrow" id="MathJax-Span-444"><span class="mi" id="MathJax-Span-445" style="font-family: MathJax_Math; font-style: italic;">n</span><span class="mi" id="MathJax-Span-446" style="font-family: MathJax_Math; font-style: italic;">d<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mi" id="MathJax-Span-447" style="font-family: MathJax_Math; font-style: italic;">e</span><span class="mi" id="MathJax-Span-448" style="font-family: MathJax_Math; font-style: italic;">p</span><span class="mi" id="MathJax-Span-449" style="font-family: MathJax_Math; font-style: italic;">t</span><span class="mi" id="MathJax-Span-450" style="font-family: MathJax_Math; font-style: italic;">h</span></span><span style="display: inline-block; width: 0px; height: 2.292em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.295em; border-left: 0px solid; width: 0px; height: 1.191em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>n</mi><mi>d</mi><mi>e</mi><mi>p</mi><mi>t</mi><mi>h</mi></math></span></span><script type="math/tex" id="MathJax-Element-70">ndepth</script>) to the answer:
<span class="MathJax_Preview" style="color: inherit; display: none;"></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-71-Frame" tabindex="0" style="text-align: center; position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;mi&gt;d&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;[&lt;/mo&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mo stretchy=&quot;false&quot;&gt;]&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;[&lt;/mo&gt;&lt;mtext&gt;ndepth&lt;/mtext&gt;&lt;mo stretchy=&quot;false&quot;&gt;]&lt;/mo&gt;&lt;mo&gt;&amp;#x22C5;&lt;/mo&gt;&lt;msup&gt;&lt;mi&gt;k&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mfrac&gt;&lt;mrow&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;mi&gt;d&lt;/mi&gt;&lt;mi&gt;e&lt;/mi&gt;&lt;mi&gt;p&lt;/mi&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mi&gt;h&lt;/mi&gt;&lt;/mrow&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/mfrac&gt;&lt;/mrow&gt;&lt;/msup&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-451" style="width: 17.346em; display: inline-block;"><span style="display: inline-block; position: relative; width: 14.427em; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(0.935em, 1014.43em, 2.698em, -1000em); top: -2.292em; left: 0em;"><span class="mrow" id="MathJax-Span-452"><span class="mi" id="MathJax-Span-453" style="font-family: MathJax_Math; font-style: italic;">d<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-454" style="font-family: MathJax_Main;">[</span><span class="mn" id="MathJax-Span-455" style="font-family: MathJax_Main;">2</span><span class="mi" id="MathJax-Span-456" style="font-family: MathJax_Math; font-style: italic;">n</span><span class="mo" id="MathJax-Span-457" style="font-family: MathJax_Main; padding-left: 0.222em;"></span><span class="mi" id="MathJax-Span-458" style="font-family: MathJax_Math; font-style: italic; padding-left: 0.222em;">i</span><span class="mo" id="MathJax-Span-459" style="font-family: MathJax_Main; padding-left: 0.222em;"></span><span class="mn" id="MathJax-Span-460" style="font-family: MathJax_Main; padding-left: 0.222em;">1</span><span class="mo" id="MathJax-Span-461" style="font-family: MathJax_Main;">]</span><span class="mo" id="MathJax-Span-462" style="font-family: MathJax_Main;">[</span><span class="mtext" id="MathJax-Span-463" style="font-family: MathJax_Main;">ndepth</span><span class="mo" id="MathJax-Span-464" style="font-family: MathJax_Main;">]</span><span class="mo" id="MathJax-Span-465" style="font-family: MathJax_Main; padding-left: 0.222em;"></span><span class="msubsup" id="MathJax-Span-466" style="padding-left: 0.222em;"><span style="display: inline-block; position: relative; width: 4.61em; height: 0px;"><span style="position: absolute; clip: rect(3.16em, 1000.5em, 4.178em, -1000em); top: -4.01em; left: 0em;"><span class="mi" id="MathJax-Span-467" style="font-family: MathJax_Math; font-style: italic;">k</span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span><span style="position: absolute; top: -4.432em; left: 0.521em;"><span class="texatom" id="MathJax-Span-468"><span class="mrow" id="MathJax-Span-469"><span class="mfrac" id="MathJax-Span-470"><span style="display: inline-block; position: relative; width: 3.774em; height: 0px; margin-right: 0.12em; margin-left: 0.12em;"><span style="position: absolute; clip: rect(3.507em, 1003.64em, 4.264em, -1000em); top: -4.442em; left: 50%; margin-left: -1.827em;"><span class="mrow" id="MathJax-Span-471"><span class="mn" id="MathJax-Span-472" style="font-size: 50%; font-family: MathJax_Main;">2</span><span class="mi" id="MathJax-Span-473" style="font-size: 50%; font-family: MathJax_Math; font-style: italic;">n</span><span class="mo" id="MathJax-Span-474" style="font-size: 50%; font-family: MathJax_Main;"></span><span class="mi" id="MathJax-Span-475" style="font-size: 50%; font-family: MathJax_Math; font-style: italic;">i</span><span class="mo" id="MathJax-Span-476" style="font-size: 50%; font-family: MathJax_Main;"></span><span class="mn" id="MathJax-Span-477" style="font-size: 50%; font-family: MathJax_Main;">1</span><span class="mo" id="MathJax-Span-478" style="font-size: 50%; font-family: MathJax_Main;"></span><span class="mi" id="MathJax-Span-479" style="font-size: 50%; font-family: MathJax_Math; font-style: italic;">n</span><span class="mi" id="MathJax-Span-480" style="font-size: 50%; font-family: MathJax_Math; font-style: italic;">d<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span class="mi" id="MathJax-Span-481" style="font-size: 50%; font-family: MathJax_Math; font-style: italic;">e</span><span class="mi" id="MathJax-Span-482" style="font-size: 50%; font-family: MathJax_Math; font-style: italic;">p</span><span class="mi" id="MathJax-Span-483" style="font-size: 50%; font-family: MathJax_Math; font-style: italic;">t</span><span class="mi" id="MathJax-Span-484" style="font-size: 50%; font-family: MathJax_Math; font-style: italic;">h</span></span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span><span style="position: absolute; clip: rect(3.521em, 1000.23em, 4.167em, -1000em); top: -3.697em; left: 50%; margin-left: -0.125em;"><span class="mn" id="MathJax-Span-485" style="font-size: 50%; font-family: MathJax_Main;">2</span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span><span style="position: absolute; clip: rect(0.82em, 1003.77em, 1.198em, -1000em); top: -1.188em; left: 0em;"><span style="display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 3.774em; height: 0px;"></span><span style="display: inline-block; width: 0px; height: 1.042em;"></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.292em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.362em; border-left: 0px solid; width: 0px; height: 1.865em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>d</mi><mo stretchy="false">[</mo><mn>2</mn><mi>n</mi><mo></mo><mi>i</mi><mo></mo><mn>1</mn><mo stretchy="false">]</mo><mo stretchy="false">[</mo><mtext>ndepth</mtext><mo stretchy="false">]</mo><mo></mo><msup><mi>k</mi><mrow class="MJX-TeXAtom-ORD"><mfrac><mrow><mn>2</mn><mi>n</mi><mo></mo><mi>i</mi><mo></mo><mn>1</mn><mo></mo><mi>n</mi><mi>d</mi><mi>e</mi><mi>p</mi><mi>t</mi><mi>h</mi></mrow><mn>2</mn></mfrac></mrow></msup></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-71">d[2n - i - 1][\text{ndepth}] \cdot k^{\frac{2n - i - 1 - ndepth}{2}}</script>
This formula can be derived as follows:
First we "forget" that there are multiple bracket types, and just take the answer <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-72-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;d&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;[&lt;/mo&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mo stretchy=&quot;false&quot;&gt;]&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;[&lt;/mo&gt;&lt;mtext&gt;ndepth&lt;/mtext&gt;&lt;mo stretchy=&quot;false&quot;&gt;]&lt;/mo&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-486" style="width: 10.888em; display: inline-block;"><span style="display: inline-block; position: relative; width: 9.063em; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(1.385em, 1008.94em, 2.698em, -1000em); top: -2.292em; left: 0em;"><span class="mrow" id="MathJax-Span-487"><span class="mi" id="MathJax-Span-488" style="font-family: MathJax_Math; font-style: italic;">d<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-489" style="font-family: MathJax_Main;">[</span><span class="mn" id="MathJax-Span-490" style="font-family: MathJax_Main;">2</span><span class="mi" id="MathJax-Span-491" style="font-family: MathJax_Math; font-style: italic;">n</span><span class="mo" id="MathJax-Span-492" style="font-family: MathJax_Main; padding-left: 0.222em;"></span><span class="mi" id="MathJax-Span-493" style="font-family: MathJax_Math; font-style: italic; padding-left: 0.222em;">i</span><span class="mo" id="MathJax-Span-494" style="font-family: MathJax_Main; padding-left: 0.222em;"></span><span class="mn" id="MathJax-Span-495" style="font-family: MathJax_Main; padding-left: 0.222em;">1</span><span class="mo" id="MathJax-Span-496" style="font-family: MathJax_Main;">]</span><span class="mo" id="MathJax-Span-497" style="font-family: MathJax_Main;">[</span><span class="mtext" id="MathJax-Span-498" style="font-family: MathJax_Main;">ndepth</span><span class="mo" id="MathJax-Span-499" style="font-family: MathJax_Main;">]</span></span><span style="display: inline-block; width: 0px; height: 2.292em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.362em; border-left: 0px solid; width: 0px; height: 1.325em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>d</mi><mo stretchy="false">[</mo><mn>2</mn><mi>n</mi><mo></mo><mi>i</mi><mo></mo><mn>1</mn><mo stretchy="false">]</mo><mo stretchy="false">[</mo><mtext>ndepth</mtext><mo stretchy="false">]</mo></math></span></span><script type="math/tex" id="MathJax-Element-72">d[2n - i - 1][\text{ndepth}]</script>.
Now we consider how the answer will change is we have <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-73-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;k&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-500" style="width: 0.628em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.521em; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(1.441em, 1000.5em, 2.459em, -1000em); top: -2.292em; left: 0em;"><span class="mrow" id="MathJax-Span-501"><span class="mi" id="MathJax-Span-502" style="font-family: MathJax_Math; font-style: italic;">k</span></span><span style="display: inline-block; width: 0px; height: 2.292em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.076em; border-left: 0px solid; width: 0px; height: 0.971em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>k</mi></math></span></span><script type="math/tex" id="MathJax-Element-73">k</script> types of brackets.
We have <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-74-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-503" style="width: 5.263em; display: inline-block;"><span style="display: inline-block; position: relative; width: 4.375em; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(1.469em, 1004.3em, 2.53em, -1000em); top: -2.292em; left: 0em;"><span class="mrow" id="MathJax-Span-504"><span class="mn" id="MathJax-Span-505" style="font-family: MathJax_Main;">2</span><span class="mi" id="MathJax-Span-506" style="font-family: MathJax_Math; font-style: italic;">n</span><span class="mo" id="MathJax-Span-507" style="font-family: MathJax_Main; padding-left: 0.222em;"></span><span class="mi" id="MathJax-Span-508" style="font-family: MathJax_Math; font-style: italic; padding-left: 0.222em;">i</span><span class="mo" id="MathJax-Span-509" style="font-family: MathJax_Main; padding-left: 0.222em;"></span><span class="mn" id="MathJax-Span-510" style="font-family: MathJax_Main; padding-left: 0.222em;">1</span></span><span style="display: inline-block; width: 0px; height: 2.292em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.161em; border-left: 0px solid; width: 0px; height: 1.023em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn>2</mn><mi>n</mi><mo></mo><mi>i</mi><mo></mo><mn>1</mn></math></span></span><script type="math/tex" id="MathJax-Element-74">2n - i - 1</script> undefined positions, of which <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-75-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mtext&gt;ndepth&lt;/mtext&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-511" style="width: 3.701em; display: inline-block;"><span style="display: inline-block; position: relative; width: 3.073em; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(1.337em, 1003.06em, 2.538em, -1000em); top: -2.188em; left: 0em;"><span class="mrow" id="MathJax-Span-512"><span class="mtext" id="MathJax-Span-513" style="font-family: MathJax_Main;">ndepth</span></span><span style="display: inline-block; width: 0px; height: 2.188em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.295em; border-left: 0px solid; width: 0px; height: 1.191em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mtext>ndepth</mtext></math></span></span><script type="math/tex" id="MathJax-Element-75">\text{ndepth}</script> are already predetermined because of the opening brackets.
But all the other brackets (<span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-76-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mtext&gt;ndepth&lt;/mtext&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo&gt;/&lt;/mo&gt;&lt;/mrow&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-514" style="width: 12.398em; display: inline-block;"><span style="display: inline-block; position: relative; width: 10.313em; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(1.385em, 1010.26em, 2.698em, -1000em); top: -2.292em; left: 0em;"><span class="mrow" id="MathJax-Span-515"><span class="mo" id="MathJax-Span-516" style="font-family: MathJax_Main;">(</span><span class="mn" id="MathJax-Span-517" style="font-family: MathJax_Main;">2</span><span class="mi" id="MathJax-Span-518" style="font-family: MathJax_Math; font-style: italic;">n</span><span class="mo" id="MathJax-Span-519" style="font-family: MathJax_Main; padding-left: 0.222em;"></span><span class="mi" id="MathJax-Span-520" style="font-family: MathJax_Math; font-style: italic; padding-left: 0.222em;">i</span><span class="mo" id="MathJax-Span-521" style="font-family: MathJax_Main; padding-left: 0.222em;"></span><span class="mi" id="MathJax-Span-522" style="font-family: MathJax_Math; font-style: italic; padding-left: 0.222em;">i</span><span class="mo" id="MathJax-Span-523" style="font-family: MathJax_Main; padding-left: 0.222em;"></span><span class="mtext" id="MathJax-Span-524" style="font-family: MathJax_Main; padding-left: 0.222em;">ndepth</span><span class="mo" id="MathJax-Span-525" style="font-family: MathJax_Main;">)</span><span class="texatom" id="MathJax-Span-526"><span class="mrow" id="MathJax-Span-527"><span class="mo" id="MathJax-Span-528" style="font-family: MathJax_Main;">/</span></span></span><span class="mn" id="MathJax-Span-529" style="font-family: MathJax_Main;">2</span></span><span style="display: inline-block; width: 0px; height: 2.292em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.362em; border-left: 0px solid; width: 0px; height: 1.325em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo stretchy="false">(</mo><mn>2</mn><mi>n</mi><mo></mo><mi>i</mi><mo></mo><mi>i</mi><mo></mo><mtext>ndepth</mtext><mo stretchy="false">)</mo><mrow class="MJX-TeXAtom-ORD"><mo>/</mo></mrow><mn>2</mn></math></span></span><script type="math/tex" id="MathJax-Element-76">(2n - i - i - \text{ndepth})/2</script> pairs) can be of any type, therefore we multiply the number by such a power of <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-77-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;k&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-530" style="width: 0.628em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.521em; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(1.441em, 1000.5em, 2.459em, -1000em); top: -2.292em; left: 0em;"><span class="mrow" id="MathJax-Span-531"><span class="mi" id="MathJax-Span-532" style="font-family: MathJax_Math; font-style: italic;">k</span></span><span style="display: inline-block; width: 0px; height: 2.292em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.076em; border-left: 0px solid; width: 0px; height: 0.971em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>k</mi></math></span></span><script type="math/tex" id="MathJax-Element-77">k</script>.</p>

<h2 id="toc-tgt-7">Finding the <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-78-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;k&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-533" style="width: 0.627em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.521em; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(1.494em, 1000.5em, 2.407em, -1000em); top: -2.292em; left: 0em;"><span class="mrow" id="MathJax-Span-534"><span class="mi" id="MathJax-Span-535" style="font-family: MathJax_Math; font-style: italic;">k</span></span><span style="display: inline-block; width: 0px; height: 2.292em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.055em; border-left: 0px solid; width: 0px; height: 0.929em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>k</mi></math></span></span><script type="math/tex" id="MathJax-Element-78">k</script>-th sequence</h2>

<p>Let <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-79-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-536" style="width: 0.784em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.625em; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(1.693em, 1000.61em, 2.459em, -1000em); top: -2.292em; left: 0em;"><span class="mrow" id="MathJax-Span-537"><span class="mi" id="MathJax-Span-538" style="font-family: MathJax_Math; font-style: italic;">n</span></span><span style="display: inline-block; width: 0px; height: 2.292em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.076em; border-left: 0px solid; width: 0px; height: 0.669em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>n</mi></math></span></span><script type="math/tex" id="MathJax-Element-79">n</script> be the number of bracket pairs in the sequence.
We have to find the <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-80-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;k&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-539" style="width: 0.628em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.521em; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(1.441em, 1000.5em, 2.459em, -1000em); top: -2.292em; left: 0em;"><span class="mrow" id="MathJax-Span-540"><span class="mi" id="MathJax-Span-541" style="font-family: MathJax_Math; font-style: italic;">k</span></span><span style="display: inline-block; width: 0px; height: 2.292em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.076em; border-left: 0px solid; width: 0px; height: 0.971em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>k</mi></math></span></span><script type="math/tex" id="MathJax-Element-80">k</script>-th balanced sequence in lexicographically sorted list of all balanced sequences for a given <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-81-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;k&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-542" style="width: 0.628em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.521em; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(1.441em, 1000.5em, 2.459em, -1000em); top: -2.292em; left: 0em;"><span class="mrow" id="MathJax-Span-543"><span class="mi" id="MathJax-Span-544" style="font-family: MathJax_Math; font-style: italic;">k</span></span><span style="display: inline-block; width: 0px; height: 2.292em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.076em; border-left: 0px solid; width: 0px; height: 0.971em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>k</mi></math></span></span><script type="math/tex" id="MathJax-Element-81">k</script>.</p>

<p>As in the previous section we compute the auxiliary array <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-82-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;d&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;[&lt;/mo&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;]&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;[&lt;/mo&gt;&lt;mi&gt;j&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;]&lt;/mo&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-545" style="width: 2.919em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.396em; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(1.385em, 1002.28em, 2.698em, -1000em); top: -2.292em; left: 0em;"><span class="mrow" id="MathJax-Span-546"><span class="mi" id="MathJax-Span-547" style="font-family: MathJax_Math; font-style: italic;">d<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-548" style="font-family: MathJax_Main;">[</span><span class="mi" id="MathJax-Span-549" style="font-family: MathJax_Math; font-style: italic;">i</span><span class="mo" id="MathJax-Span-550" style="font-family: MathJax_Main;">]</span><span class="mo" id="MathJax-Span-551" style="font-family: MathJax_Main;">[</span><span class="mi" id="MathJax-Span-552" style="font-family: MathJax_Math; font-style: italic;">j</span><span class="mo" id="MathJax-Span-553" style="font-family: MathJax_Main;">]</span></span><span style="display: inline-block; width: 0px; height: 2.292em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.362em; border-left: 0px solid; width: 0px; height: 1.325em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>d</mi><mo stretchy="false">[</mo><mi>i</mi><mo stretchy="false">]</mo><mo stretchy="false">[</mo><mi>j</mi><mo stretchy="false">]</mo></math></span></span><script type="math/tex" id="MathJax-Element-82">d[i][j]</script>, the number of semi-balanced bracket sequences of length <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-83-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-554" style="width: 0.471em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.365em; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(1.474em, 1000.32em, 2.459em, -1000em); top: -2.292em; left: 0em;"><span class="mrow" id="MathJax-Span-555"><span class="mi" id="MathJax-Span-556" style="font-family: MathJax_Math; font-style: italic;">i</span></span><span style="display: inline-block; width: 0px; height: 2.292em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.076em; border-left: 0px solid; width: 0px; height: 0.931em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>i</mi></math></span></span><script type="math/tex" id="MathJax-Element-83">i</script> with balance <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-84-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;j&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-557" style="width: 0.523em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.417em; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(1.474em, 1000.41em, 2.652em, -1000em); top: -2.292em; left: 0em;"><span class="mrow" id="MathJax-Span-558"><span class="mi" id="MathJax-Span-559" style="font-family: MathJax_Math; font-style: italic;">j</span></span><span style="display: inline-block; width: 0px; height: 2.292em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.307em; border-left: 0px solid; width: 0px; height: 1.163em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>j</mi></math></span></span><script type="math/tex" id="MathJax-Element-84">j</script>.</p>

<p>First, we start with only one bracket type.</p>

<p>We will iterate over the characters in the string we want to generate.
As in the previous problem we store a counter <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-85-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mtext&gt;depth&lt;/mtext&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-560" style="width: 3.023em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.5em; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(1.337em, 1002.49em, 2.538em, -1000em); top: -2.188em; left: 0em;"><span class="mrow" id="MathJax-Span-561"><span class="mtext" id="MathJax-Span-562" style="font-family: MathJax_Main;">depth</span></span><span style="display: inline-block; width: 0px; height: 2.188em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.295em; border-left: 0px solid; width: 0px; height: 1.191em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mtext>depth</mtext></math></span></span><script type="math/tex" id="MathJax-Element-85">\text{depth}</script>, the current nesting depth.
In each position we have to decide if we use an opening of a closing bracket.
To have to put an opening bracket character, it <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-86-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;d&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;[&lt;/mo&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mo stretchy=&quot;false&quot;&gt;]&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;[&lt;/mo&gt;&lt;mtext&gt;depth&lt;/mtext&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mo stretchy=&quot;false&quot;&gt;]&lt;/mo&gt;&lt;mo&gt;&amp;#x2265;&lt;/mo&gt;&lt;mi&gt;k&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-563" style="width: 14.534em; display: inline-block;"><span style="display: inline-block; position: relative; width: 12.083em; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(1.385em, 1012.07em, 2.698em, -1000em); top: -2.292em; left: 0em;"><span class="mrow" id="MathJax-Span-564"><span class="mi" id="MathJax-Span-565" style="font-family: MathJax_Math; font-style: italic;">d<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-566" style="font-family: MathJax_Main;">[</span><span class="mn" id="MathJax-Span-567" style="font-family: MathJax_Main;">2</span><span class="mi" id="MathJax-Span-568" style="font-family: MathJax_Math; font-style: italic;">n</span><span class="mo" id="MathJax-Span-569" style="font-family: MathJax_Main; padding-left: 0.222em;"></span><span class="mi" id="MathJax-Span-570" style="font-family: MathJax_Math; font-style: italic; padding-left: 0.222em;">i</span><span class="mo" id="MathJax-Span-571" style="font-family: MathJax_Main; padding-left: 0.222em;"></span><span class="mn" id="MathJax-Span-572" style="font-family: MathJax_Main; padding-left: 0.222em;">1</span><span class="mo" id="MathJax-Span-573" style="font-family: MathJax_Main;">]</span><span class="mo" id="MathJax-Span-574" style="font-family: MathJax_Main;">[</span><span class="mtext" id="MathJax-Span-575" style="font-family: MathJax_Main;">depth</span><span class="mo" id="MathJax-Span-576" style="font-family: MathJax_Main; padding-left: 0.222em;">+</span><span class="mn" id="MathJax-Span-577" style="font-family: MathJax_Main; padding-left: 0.222em;">1</span><span class="mo" id="MathJax-Span-578" style="font-family: MathJax_Main;">]</span><span class="mo" id="MathJax-Span-579" style="font-family: MathJax_Main; padding-left: 0.278em;"></span><span class="mi" id="MathJax-Span-580" style="font-family: MathJax_Math; font-style: italic; padding-left: 0.278em;">k</span></span><span style="display: inline-block; width: 0px; height: 2.292em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.362em; border-left: 0px solid; width: 0px; height: 1.325em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>d</mi><mo stretchy="false">[</mo><mn>2</mn><mi>n</mi><mo></mo><mi>i</mi><mo></mo><mn>1</mn><mo stretchy="false">]</mo><mo stretchy="false">[</mo><mtext>depth</mtext><mo>+</mo><mn>1</mn><mo stretchy="false">]</mo><mo></mo><mi>k</mi></math></span></span><script type="math/tex" id="MathJax-Element-86">d[2n - i - 1][\text{depth}+1] \ge k</script>.
We increment the counter <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-87-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mtext&gt;depth&lt;/mtext&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-581" style="width: 3.023em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.5em; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(1.337em, 1002.49em, 2.538em, -1000em); top: -2.188em; left: 0em;"><span class="mrow" id="MathJax-Span-582"><span class="mtext" id="MathJax-Span-583" style="font-family: MathJax_Main;">depth</span></span><span style="display: inline-block; width: 0px; height: 2.188em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.295em; border-left: 0px solid; width: 0px; height: 1.191em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mtext>depth</mtext></math></span></span><script type="math/tex" id="MathJax-Element-87">\text{depth}</script>, and move on to the next character.
Otherwise we decrement <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-88-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;k&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-584" style="width: 0.628em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.521em; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(1.441em, 1000.5em, 2.459em, -1000em); top: -2.292em; left: 0em;"><span class="mrow" id="MathJax-Span-585"><span class="mi" id="MathJax-Span-586" style="font-family: MathJax_Math; font-style: italic;">k</span></span><span style="display: inline-block; width: 0px; height: 2.292em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.076em; border-left: 0px solid; width: 0px; height: 0.971em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>k</mi></math></span></span><script type="math/tex" id="MathJax-Element-88">k</script> by <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-89-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;d&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;[&lt;/mo&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mo stretchy=&quot;false&quot;&gt;]&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;[&lt;/mo&gt;&lt;mtext&gt;depth&lt;/mtext&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mo stretchy=&quot;false&quot;&gt;]&lt;/mo&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-587" style="width: 12.346em; display: inline-block;"><span style="display: inline-block; position: relative; width: 10.26em; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(1.385em, 1010.14em, 2.698em, -1000em); top: -2.292em; left: 0em;"><span class="mrow" id="MathJax-Span-588"><span class="mi" id="MathJax-Span-589" style="font-family: MathJax_Math; font-style: italic;">d<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-590" style="font-family: MathJax_Main;">[</span><span class="mn" id="MathJax-Span-591" style="font-family: MathJax_Main;">2</span><span class="mi" id="MathJax-Span-592" style="font-family: MathJax_Math; font-style: italic;">n</span><span class="mo" id="MathJax-Span-593" style="font-family: MathJax_Main; padding-left: 0.222em;"></span><span class="mi" id="MathJax-Span-594" style="font-family: MathJax_Math; font-style: italic; padding-left: 0.222em;">i</span><span class="mo" id="MathJax-Span-595" style="font-family: MathJax_Main; padding-left: 0.222em;"></span><span class="mn" id="MathJax-Span-596" style="font-family: MathJax_Main; padding-left: 0.222em;">1</span><span class="mo" id="MathJax-Span-597" style="font-family: MathJax_Main;">]</span><span class="mo" id="MathJax-Span-598" style="font-family: MathJax_Main;">[</span><span class="mtext" id="MathJax-Span-599" style="font-family: MathJax_Main;">depth</span><span class="mo" id="MathJax-Span-600" style="font-family: MathJax_Main; padding-left: 0.222em;">+</span><span class="mn" id="MathJax-Span-601" style="font-family: MathJax_Main; padding-left: 0.222em;">1</span><span class="mo" id="MathJax-Span-602" style="font-family: MathJax_Main;">]</span></span><span style="display: inline-block; width: 0px; height: 2.292em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.362em; border-left: 0px solid; width: 0px; height: 1.325em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>d</mi><mo stretchy="false">[</mo><mn>2</mn><mi>n</mi><mo></mo><mi>i</mi><mo></mo><mn>1</mn><mo stretchy="false">]</mo><mo stretchy="false">[</mo><mtext>depth</mtext><mo>+</mo><mn>1</mn><mo stretchy="false">]</mo></math></span></span><script type="math/tex" id="MathJax-Element-89">d[2n - i - 1][\text{depth}+1]</script>, put a closing bracket and move on.</p>

<pre><code class="cpp hljs"><span class="hljs-built_in">string</span> kth_balanced(<span class="hljs-keyword">int</span> n, <span class="hljs-keyword">int</span> k) {
    <span class="hljs-stl_container"><span class="hljs-built_in">vector</span>&lt;<span class="hljs-stl_container"><span class="hljs-built_in">vector</span>&lt;<span class="hljs-keyword">int</span>&gt;</span>&gt;</span> d(<span class="hljs-number">2</span>*n+<span class="hljs-number">1</span>, <span class="hljs-stl_container"><span class="hljs-built_in">vector</span>&lt;<span class="hljs-keyword">int</span>&gt;</span>(n+<span class="hljs-number">1</span>, <span class="hljs-number">0</span>));
    d[<span class="hljs-number">0</span>][<span class="hljs-number">0</span>] = <span class="hljs-number">1</span>;
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">1</span>; i &lt;= <span class="hljs-number">2</span>*n; i++) {
        d[i][<span class="hljs-number">0</span>] = d[i-<span class="hljs-number">1</span>][<span class="hljs-number">1</span>];
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> j = <span class="hljs-number">1</span>; j &lt; n; j++)
            d[i][j] = d[i-<span class="hljs-number">1</span>][j-<span class="hljs-number">1</span>] + d[i-<span class="hljs-number">1</span>][j+<span class="hljs-number">1</span>];
        d[i][n] = d[i-<span class="hljs-number">1</span>][n-<span class="hljs-number">1</span>];
    }

    <span class="hljs-built_in">string</span> ans;
    <span class="hljs-keyword">int</span> depth = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">2</span>*n; i++) {
        <span class="hljs-keyword">if</span> (depth + <span class="hljs-number">1</span> &lt;= n &amp;&amp; d[<span class="hljs-number">2</span>*n-i-<span class="hljs-number">1</span>][depth+<span class="hljs-number">1</span>] &gt;= k) {
            ans += <span class="hljs-string">'('</span>;
            depth++;
        } <span class="hljs-keyword">else</span> {
            ans += <span class="hljs-string">')'</span>;
            <span class="hljs-keyword">if</span> (depth + <span class="hljs-number">1</span> &lt;= n)
                k -= d[<span class="hljs-number">2</span>*n-i-<span class="hljs-number">1</span>][depth+<span class="hljs-number">1</span>];
            depth--;
        }
    }
    <span class="hljs-keyword">return</span> ans;
}
</code></pre>

<p>Now let there be <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-90-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;k&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-603" style="width: 0.628em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.521em; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(1.441em, 1000.5em, 2.459em, -1000em); top: -2.292em; left: 0em;"><span class="mrow" id="MathJax-Span-604"><span class="mi" id="MathJax-Span-605" style="font-family: MathJax_Math; font-style: italic;">k</span></span><span style="display: inline-block; width: 0px; height: 2.292em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.076em; border-left: 0px solid; width: 0px; height: 0.971em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>k</mi></math></span></span><script type="math/tex" id="MathJax-Element-90">k</script> types of brackets.
The solution will only differ slightly in that we have to multiply the value <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-91-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;d&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;[&lt;/mo&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mo stretchy=&quot;false&quot;&gt;]&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;[&lt;/mo&gt;&lt;mtext&gt;ndepth&lt;/mtext&gt;&lt;mo stretchy=&quot;false&quot;&gt;]&lt;/mo&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-606" style="width: 10.888em; display: inline-block;"><span style="display: inline-block; position: relative; width: 9.063em; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(1.385em, 1008.94em, 2.698em, -1000em); top: -2.292em; left: 0em;"><span class="mrow" id="MathJax-Span-607"><span class="mi" id="MathJax-Span-608" style="font-family: MathJax_Math; font-style: italic;">d<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-609" style="font-family: MathJax_Main;">[</span><span class="mn" id="MathJax-Span-610" style="font-family: MathJax_Main;">2</span><span class="mi" id="MathJax-Span-611" style="font-family: MathJax_Math; font-style: italic;">n</span><span class="mo" id="MathJax-Span-612" style="font-family: MathJax_Main; padding-left: 0.222em;"></span><span class="mi" id="MathJax-Span-613" style="font-family: MathJax_Math; font-style: italic; padding-left: 0.222em;">i</span><span class="mo" id="MathJax-Span-614" style="font-family: MathJax_Main; padding-left: 0.222em;"></span><span class="mn" id="MathJax-Span-615" style="font-family: MathJax_Main; padding-left: 0.222em;">1</span><span class="mo" id="MathJax-Span-616" style="font-family: MathJax_Main;">]</span><span class="mo" id="MathJax-Span-617" style="font-family: MathJax_Main;">[</span><span class="mtext" id="MathJax-Span-618" style="font-family: MathJax_Main;">ndepth</span><span class="mo" id="MathJax-Span-619" style="font-family: MathJax_Main;">]</span></span><span style="display: inline-block; width: 0px; height: 2.292em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.362em; border-left: 0px solid; width: 0px; height: 1.325em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>d</mi><mo stretchy="false">[</mo><mn>2</mn><mi>n</mi><mo></mo><mi>i</mi><mo></mo><mn>1</mn><mo stretchy="false">]</mo><mo stretchy="false">[</mo><mtext>ndepth</mtext><mo stretchy="false">]</mo></math></span></span><script type="math/tex" id="MathJax-Element-91">d[2n-i-1][\text{ndepth}]</script> by <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-92-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msup&gt;&lt;mi&gt;k&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mtext&gt;ndepth&lt;/mtext&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo&gt;/&lt;/mo&gt;&lt;/mrow&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/mrow&gt;&lt;/msup&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-620" style="width: 8.44em; display: inline-block;"><span style="display: inline-block; position: relative; width: 7.031em; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(1.138em, 1007.03em, 2.355em, -1000em); top: -2.188em; left: 0em;"><span class="mrow" id="MathJax-Span-621"><span class="msubsup" id="MathJax-Span-622"><span style="display: inline-block; position: relative; width: 7.041em; height: 0px;"><span style="position: absolute; clip: rect(3.16em, 1000.5em, 4.178em, -1000em); top: -4.01em; left: 0em;"><span class="mi" id="MathJax-Span-623" style="font-family: MathJax_Math; font-style: italic;">k</span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span><span style="position: absolute; top: -4.373em; left: 0.521em;"><span class="texatom" id="MathJax-Span-624"><span class="mrow" id="MathJax-Span-625"><span class="mo" id="MathJax-Span-626" style="font-size: 70.7%; font-family: MathJax_Main;">(</span><span class="mn" id="MathJax-Span-627" style="font-size: 70.7%; font-family: MathJax_Main;">2</span><span class="mi" id="MathJax-Span-628" style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;">n</span><span class="mo" id="MathJax-Span-629" style="font-size: 70.7%; font-family: MathJax_Main;"></span><span class="mi" id="MathJax-Span-630" style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;">i</span><span class="mo" id="MathJax-Span-631" style="font-size: 70.7%; font-family: MathJax_Main;"></span><span class="mn" id="MathJax-Span-632" style="font-size: 70.7%; font-family: MathJax_Main;">1</span><span class="mo" id="MathJax-Span-633" style="font-size: 70.7%; font-family: MathJax_Main;"></span><span class="mtext" id="MathJax-Span-634" style="font-size: 70.7%; font-family: MathJax_Main;">ndepth</span><span class="mo" id="MathJax-Span-635" style="font-size: 70.7%; font-family: MathJax_Main;">)</span><span class="texatom" id="MathJax-Span-636"><span class="mrow" id="MathJax-Span-637"><span class="mo" id="MathJax-Span-638" style="font-size: 70.7%; font-family: MathJax_Main;">/</span></span></span><span class="mn" id="MathJax-Span-639" style="font-size: 70.7%; font-family: MathJax_Main;">2</span></span></span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.188em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.076em; border-left: 0px solid; width: 0px; height: 1.21em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msup><mi>k</mi><mrow class="MJX-TeXAtom-ORD"><mo stretchy="false">(</mo><mn>2</mn><mi>n</mi><mo></mo><mi>i</mi><mo></mo><mn>1</mn><mo></mo><mtext>ndepth</mtext><mo stretchy="false">)</mo><mrow class="MJX-TeXAtom-ORD"><mo>/</mo></mrow><mn>2</mn></mrow></msup></math></span></span><script type="math/tex" id="MathJax-Element-92">k^{(2n-i-1-\text{ndepth})/2}</script> and take into account that there can be different bracket types for the next character.</p>

<p>Here is an implementation using two types of brackets: round and square:</p>

<pre><code class="cpp hljs"><span class="hljs-built_in">string</span> kth_balanced2(<span class="hljs-keyword">int</span> n, <span class="hljs-keyword">int</span> k) {
    <span class="hljs-stl_container"><span class="hljs-built_in">vector</span>&lt;<span class="hljs-stl_container"><span class="hljs-built_in">vector</span>&lt;<span class="hljs-keyword">int</span>&gt;</span>&gt;</span> d(<span class="hljs-number">2</span>*n+<span class="hljs-number">1</span>, <span class="hljs-stl_container"><span class="hljs-built_in">vector</span>&lt;<span class="hljs-keyword">int</span>&gt;</span>(n+<span class="hljs-number">1</span>, <span class="hljs-number">0</span>));
    d[<span class="hljs-number">0</span>][<span class="hljs-number">0</span>] = <span class="hljs-number">1</span>;
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">1</span>; i &lt;= <span class="hljs-number">2</span>*n; i++) {
        d[i][<span class="hljs-number">0</span>] = d[i-<span class="hljs-number">1</span>][<span class="hljs-number">1</span>];
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> j = <span class="hljs-number">1</span>; j &lt; n; j++)
            d[i][j] = d[i-<span class="hljs-number">1</span>][j-<span class="hljs-number">1</span>] + d[i-<span class="hljs-number">1</span>][j+<span class="hljs-number">1</span>];
        d[i][n] = d[i-<span class="hljs-number">1</span>][n-<span class="hljs-number">1</span>];
    }

    <span class="hljs-built_in">string</span> ans;
    <span class="hljs-keyword">int</span> depth = <span class="hljs-number">0</span>;
    <span class="hljs-stl_container"><span class="hljs-built_in">stack</span>&lt;<span class="hljs-keyword">char</span>&gt;</span> st;
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">2</span>*n; i++) {
        <span class="hljs-comment">// '('</span>
        <span class="hljs-keyword">if</span> (depth + <span class="hljs-number">1</span> &lt;= n) {
            <span class="hljs-keyword">int</span> cnt = d[<span class="hljs-number">2</span>*n-i-<span class="hljs-number">1</span>][depth+<span class="hljs-number">1</span>] &lt;&lt; ((<span class="hljs-number">2</span>*n-i-<span class="hljs-number">1</span>-depth-<span class="hljs-number">1</span>) / <span class="hljs-number">2</span>);
            <span class="hljs-keyword">if</span> (cnt &gt;= k) {
                ans += <span class="hljs-string">'('</span>;
                st.push(<span class="hljs-string">'('</span>);
                depth++;
                <span class="hljs-keyword">continue</span>;
            }
            k -= cnt;
        }

        <span class="hljs-comment">// ')'</span>
        <span class="hljs-keyword">if</span> (depth &amp;&amp; st.top() == <span class="hljs-string">'('</span>) {
            <span class="hljs-keyword">int</span> cnt = d[<span class="hljs-number">2</span>*n-i-<span class="hljs-number">1</span>][depth-<span class="hljs-number">1</span>] &lt;&lt; ((<span class="hljs-number">2</span>*n-i-<span class="hljs-number">1</span>-depth+<span class="hljs-number">1</span>) / <span class="hljs-number">2</span>);
            <span class="hljs-keyword">if</span> (cnt &gt;= k) {
                ans += <span class="hljs-string">')'</span>;
                st.pop();
                depth--;
                <span class="hljs-keyword">continue</span>;
            }
            k -= cnt;
        }

        <span class="hljs-comment">// '['</span>
        <span class="hljs-keyword">if</span> (depth + <span class="hljs-number">1</span> &lt;= n) {
            <span class="hljs-keyword">int</span> cnt = d[<span class="hljs-number">2</span>*n-i-<span class="hljs-number">1</span>][depth+<span class="hljs-number">1</span>] &lt;&lt; ((<span class="hljs-number">2</span>*n-i-<span class="hljs-number">1</span>-depth-<span class="hljs-number">1</span>) / <span class="hljs-number">2</span>);
            <span class="hljs-keyword">if</span> (cnt &gt;= k) {
                ans += <span class="hljs-string">'['</span>;
                st.push(<span class="hljs-string">'['</span>);
                depth++;
                <span class="hljs-keyword">continue</span>;
            }
            k -= cnt;
        }

        <span class="hljs-comment">// ']'</span>
        ans += <span class="hljs-string">']'</span>;
        st.pop();
        depth--;
    }
    <span class="hljs-keyword">return</span> ans;
}
</code></pre>

    <div id="footer">
    (c) 2014-2018 translation by <a href="http://github.com/e-maxx-eng">http://github.com/e-maxx-eng</a>
    <span style="float: right; cursor: pointer;">11:604/214</span></div>
</div>

<script>
if (/e\-maxx\-eng/.test(location.href)) {
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-85220282-1', 'auto');
  ga('send', 'pageview');
}
</script>


<div style="position: absolute; width: 0px; height: 0px; overflow: hidden; padding: 0px; border: 0px none; margin: 0px;"><div id="MathJax_Font_Test" style="position: absolute; visibility: hidden; top: 0px; left: 0px; width: auto; padding: 0px; border: 0px none; margin: 0px; white-space: nowrap; text-align: left; text-indent: 0px; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal; font-size: 40px; font-weight: normal; font-style: normal; font-size-adjust: none; font-family: MathJax_Size2, sans-serif;"></div></div></body></html>